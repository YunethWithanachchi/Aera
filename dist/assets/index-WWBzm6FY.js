(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();const Mc="dunqbmfkd",Lc="Aera_chat_upload";window.myWidget=cloudinary.createUploadWidget({cloudName:Mc,uploadPreset:Lc,sources:["local","camera"],multiple:!1,cropping:!1,folder:"chatImages",maxFileSize:1e7},async(t,e)=>{!t&&e.event==="success"&&(console.log("Image uploaded",e.info.secure_url),window.dispatchEvent(new CustomEvent("cloudinary-upload",{detail:e.info.secure_url})))});const Fc=()=>{};var ws={};const Ur={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const m=function(t,e){if(!t)throw Je(e)},Je=function(t){return new Error("Firebase Database ("+Ur.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};const $r=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},jc=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const s=t[n++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=t[n++];e[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=t[n++],o=t[n++],a=t[n++],c=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{const r=t[n++],o=t[n++];e[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return e.join("")},bi={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<t.length;s+=3){const r=t[s],o=s+1<t.length,a=o?t[s+1]:0,c=s+2<t.length,l=c?t[s+2]:0,d=r>>2,h=(r&3)<<4|a>>4;let u=(a&15)<<2|l>>6,f=l&63;c||(f=64,o||(u=64)),i.push(n[d],n[h],n[u],n[f])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray($r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):jc(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<t.length;){const r=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const l=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,r==null||a==null||l==null||h==null)throw new Bc;const u=r<<2|a>>4;if(i.push(u),l!==64){const f=a<<4&240|l>>2;if(i.push(f),h!==64){const _=l<<6&192|h;i.push(_)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Bc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Wr=function(t){const e=$r(t);return bi.encodeByteArray(e,!0)},Wt=function(t){return Wr(t).replace(/\./g,"")},Xn=function(t){try{return bi.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Uc(t){return Hr(void 0,t)}function Hr(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!$c(n)||(t[n]=Hr(t[n],e[n]));return t}function $c(t){return t!=="__proto__"}function Wc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Hc=()=>Wc().__FIREBASE_DEFAULTS__,Vc=()=>{if(typeof process>"u"||typeof ws>"u")return;const t=ws.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},zc=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Xn(t[1]);return e&&JSON.parse(e)},Vr=()=>{try{return Fc()||Hc()||Vc()||zc()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Gc=t=>Vr()?.emulatorHosts?.[t],zr=t=>{const e=Gc(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},Gr=()=>Vr()?.config;class hn{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}function fn(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function qr(t){return(await fetch(t,{credentials:"include"})).ok}function Kr(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...t};return[Wt(JSON.stringify(n)),Wt(JSON.stringify(o)),""].join(".")}const ut={};function qc(){const t={prod:[],emulator:[]};for(const e of Object.keys(ut))ut[e]?t.emulator.push(e):t.prod.push(e);return t}function Kc(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let Cs=!1;function Yr(t,e){if(typeof window>"u"||typeof document>"u"||!fn(window.location.host)||ut[t]===e||ut[t]||Cs)return;ut[t]=e;function n(u){return`__firebase__banner__${u}`}const i="__firebase__banner",r=qc().prod.length>0;function o(){const u=document.getElementById(i);u&&u.remove()}function a(u){u.style.display="flex",u.style.background="#7faaf0",u.style.position="fixed",u.style.bottom="5px",u.style.left="5px",u.style.padding=".5em",u.style.borderRadius="5px",u.style.alignItems="center"}function c(u,f){u.setAttribute("width","24"),u.setAttribute("id",f),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px"}function l(){const u=document.createElement("span");return u.style.cursor="pointer",u.style.marginLeft="16px",u.style.fontSize="24px",u.innerHTML=" &times;",u.onclick=()=>{Cs=!0,o()},u}function d(u,f){u.setAttribute("id",f),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline"}function h(){const u=Kc(i),f=n("text"),_=document.getElementById(f)||document.createElement("span"),v=n("learnmore"),b=document.getElementById(v)||document.createElement("a"),M=n("preprendIcon"),y=document.getElementById(M)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(u.created){const w=u.element;a(w),d(b,v);const R=l();c(y,M),w.append(y,_,b,R),document.body.appendChild(w)}r?(_.innerText="Preview backend disconnected.",y.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(y.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",f)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}function Yc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Qr(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Yc())}function Qc(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function Xc(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Jc(){return Ur.NODE_ADMIN===!0}function Xr(){try{return typeof indexedDB=="object"}catch{return!1}}function Jr(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(n){e(n)}})}function Zc(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}const el="FirebaseError";class Ce extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=el,Object.setPrototypeOf(this,Ce.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,pn.prototype.create)}}class pn{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?tl(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ce(s,a,i)}}function tl(t,e){return t.replace(nl,(n,i)=>{const s=e[i];return s!=null?String(s):`<${i}?>`})}const nl=/\{\$([^}]+)}/g;function gt(t){return JSON.parse(t)}function B(t){return JSON.stringify(t)}const Zr=function(t){let e={},n={},i={},s="";try{const r=t.split(".");e=gt(Xn(r[0])||""),n=gt(Xn(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:i,signature:s}},il=function(t){const e=Zr(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},sl=function(t){const e=Zr(t).claims;return typeof e=="object"&&e.admin===!0};function _e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ge(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function Is(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ht(t,e,n){const i={};for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i[s]=e.call(n,t[s],s,t));return i}function yt(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const s of n){if(!i.includes(s))return!1;const r=t[s],o=e[s];if(Ts(r)&&Ts(o)){if(!yt(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!n.includes(s))return!1;return!0}function Ts(t){return t!==null&&typeof t=="object"}function rl(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}class ol{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const i=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)i[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)i[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const u=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=(u<<1|u>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,d;for(let h=0;h<80;h++){h<40?h<20?(l=a^r&(o^a),d=1518500249):(l=r^o^a,d=1859775393):h<60?(l=r&o|a&(r|o),d=2400959708):(l=r^o^a,d=3395469782);const u=(s<<5|s>>>27)+l+c+d+i[h]&4294967295;c=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=u}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const i=n-this.blockSize;let s=0;const r=this.buf_;let o=this.inbuf_;for(;s<n;){if(o===0)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if(typeof e=="string"){for(;s<n;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<n;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=n&255,n/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function wi(t,e){return`${t} failed: ${e} argument `}const al=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let s=t.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,m(i<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):s<65536?(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},mn=function(t){let e=0;for(let n=0;n<t.length;n++){const i=t.charCodeAt(n);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,n++):e+=3}return e};const cl=1e3,ll=2,ul=14400*1e3,dl=.5;function Ss(t,e=cl,n=ll){const i=e*Math.pow(n,t),s=Math.round(dl*i*(Math.random()-.5)*2);return Math.min(ul,i+s)}function ae(t){return t&&t._delegate?t._delegate:t}class re{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Te="[DEFAULT]";class hl{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new hn;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pl(e))try{this.getOrInitializeService({instanceIdentifier:Te})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=Te){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Te){return this.instances.has(e)}getOptions(e=Te){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(e,n){const i=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(i)??new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const s of i)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:fl(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=Te){return this.component?this.component.multipleInstances?e:Te:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function fl(t){return t===Te?void 0:t}function pl(t){return t.instantiationMode==="EAGER"}class ml{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new hl(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var x;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(x||(x={}));const _l={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},gl=x.INFO,yl={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},vl=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),s=yl[e];if(s)console[s](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Ci{constructor(e){this.name=e,this._logLevel=gl,this._logHandler=vl,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?_l[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}const El=(t,e)=>e.some(n=>t instanceof n);let ks,Rs;function bl(){return ks||(ks=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function wl(){return Rs||(Rs=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const eo=new WeakMap,Jn=new WeakMap,to=new WeakMap,Rn=new WeakMap,Ii=new WeakMap;function Cl(t){const e=new Promise((n,i)=>{const s=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(ye(t.result)),s()},o=()=>{i(t.error),s()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&eo.set(n,t)}).catch(()=>{}),Ii.set(e,t),e}function Il(t){if(Jn.has(t))return;const e=new Promise((n,i)=>{const s=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),s()},o=()=>{i(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});Jn.set(t,e)}let Zn={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Jn.get(t);if(e==="objectStoreNames")return t.objectStoreNames||to.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ye(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function Tl(t){Zn=t(Zn)}function Sl(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(An(this),e,...n);return to.set(i,e.sort?e.sort():[e]),ye(i)}:wl().includes(t)?function(...e){return t.apply(An(this),e),ye(eo.get(this))}:function(...e){return ye(t.apply(An(this),e))}}function kl(t){return typeof t=="function"?Sl(t):(t instanceof IDBTransaction&&Il(t),El(t,bl())?new Proxy(t,Zn):t)}function ye(t){if(t instanceof IDBRequest)return Cl(t);if(Rn.has(t))return Rn.get(t);const e=kl(t);return e!==t&&(Rn.set(t,e),Ii.set(e,t)),e}const An=t=>Ii.get(t);function no(t,e,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(t,e),a=ye(o);return i&&o.addEventListener("upgradeneeded",c=>{i(ye(o.result),c.oldVersion,c.newVersion,ye(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{r&&c.addEventListener("close",()=>r()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const Rl=["get","getKey","getAll","getAllKeys","count"],Al=["put","add","delete","clear"],Nn=new Map;function As(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Nn.get(e))return Nn.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,s=Al.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||Rl.includes(n)))return;const r=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let l=c.store;return i&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),s&&c.done]))[0]};return Nn.set(e,r),r}Tl(t=>({...t,get:(e,n,i)=>As(e,n)||t.get(e,n,i),has:(e,n)=>!!As(e,n)||t.has(e,n)}));class Nl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(xl(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function xl(t){return t.getComponent()?.type==="VERSION"}const ei="@firebase/app",Ns="0.14.6";const he=new Ci("@firebase/app"),Dl="@firebase/app-compat",Pl="@firebase/analytics-compat",Ol="@firebase/analytics",Ml="@firebase/app-check-compat",Ll="@firebase/app-check",Fl="@firebase/auth",jl="@firebase/auth-compat",Bl="@firebase/database",Ul="@firebase/data-connect",$l="@firebase/database-compat",Wl="@firebase/functions",Hl="@firebase/functions-compat",Vl="@firebase/installations",zl="@firebase/installations-compat",Gl="@firebase/messaging",ql="@firebase/messaging-compat",Kl="@firebase/performance",Yl="@firebase/performance-compat",Ql="@firebase/remote-config",Xl="@firebase/remote-config-compat",Jl="@firebase/storage",Zl="@firebase/storage-compat",eu="@firebase/firestore",tu="@firebase/ai",nu="@firebase/firestore-compat",iu="firebase",su="12.6.0";const ti="[DEFAULT]",ru={[ei]:"fire-core",[Dl]:"fire-core-compat",[Ol]:"fire-analytics",[Pl]:"fire-analytics-compat",[Ll]:"fire-app-check",[Ml]:"fire-app-check-compat",[Fl]:"fire-auth",[jl]:"fire-auth-compat",[Bl]:"fire-rtdb",[Ul]:"fire-data-connect",[$l]:"fire-rtdb-compat",[Wl]:"fire-fn",[Hl]:"fire-fn-compat",[Vl]:"fire-iid",[zl]:"fire-iid-compat",[Gl]:"fire-fcm",[ql]:"fire-fcm-compat",[Kl]:"fire-perf",[Yl]:"fire-perf-compat",[Ql]:"fire-rc",[Xl]:"fire-rc-compat",[Jl]:"fire-gcs",[Zl]:"fire-gcs-compat",[eu]:"fire-fst",[nu]:"fire-fst-compat",[tu]:"fire-vertex","fire-js":"fire-js",[iu]:"fire-js-all"};const Vt=new Map,ou=new Map,ni=new Map;function xs(t,e){try{t.container.addComponent(e)}catch(n){he.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function fe(t){const e=t.name;if(ni.has(e))return he.debug(`There were multiple attempts to register component ${e}.`),!1;ni.set(e,t);for(const n of Vt.values())xs(n,t);for(const n of ou.values())xs(n,t);return!0}function Ze(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function io(t){return t==null?!1:t.settings!==void 0}const au={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ve=new pn("app","Firebase",au);class cu{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new re("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ve.create("app-deleted",{appName:this._name})}}const so=su;function ro(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i={name:ti,automaticDataCollectionEnabled:!0,...e},s=i.name;if(typeof s!="string"||!s)throw ve.create("bad-app-name",{appName:String(s)});if(n||(n=Gr()),!n)throw ve.create("no-options");const r=Vt.get(s);if(r){if(yt(n,r.options)&&yt(i,r.config))return r;throw ve.create("duplicate-app",{appName:s})}const o=new ml(s);for(const c of ni.values())o.addComponent(c);const a=new cu(n,i,o);return Vt.set(s,a),a}function Ti(t=ti){const e=Vt.get(t);if(!e&&t===ti&&Gr())return ro();if(!e)throw ve.create("no-app",{appName:t});return e}function X(t,e,n){let i=ru[t]??t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),r=e.match(/\s|\//);if(s||r){const o=[`Unable to register library "${i}" with version "${e}":`];s&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),he.warn(o.join(" "));return}fe(new re(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const lu="firebase-heartbeat-database",uu=1,vt="firebase-heartbeat-store";let xn=null;function oo(){return xn||(xn=no(lu,uu,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(vt)}catch(n){console.warn(n)}}}}).catch(t=>{throw ve.create("idb-open",{originalErrorMessage:t.message})})),xn}async function du(t){try{const n=(await oo()).transaction(vt),i=await n.objectStore(vt).get(ao(t));return await n.done,i}catch(e){if(e instanceof Ce)he.warn(e.message);else{const n=ve.create("idb-get",{originalErrorMessage:e?.message});he.warn(n.message)}}}async function Ds(t,e){try{const i=(await oo()).transaction(vt,"readwrite");await i.objectStore(vt).put(e,ao(t)),await i.done}catch(n){if(n instanceof Ce)he.warn(n.message);else{const i=ve.create("idb-set",{originalErrorMessage:n?.message});he.warn(i.message)}}}function ao(t){return`${t.name}!${t.options.appId}`}const hu=1024,fu=30;class pu{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new _u(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=Ps();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>fu){const s=gu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){he.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Ps(),{heartbeatsToSend:n,unsentEntries:i}=mu(this._heartbeatsCache.heartbeats),s=Wt(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return he.warn(e),""}}}function Ps(){return new Date().toISOString().substring(0,10)}function mu(t,e=hu){const n=[];let i=t.slice();for(const s of t){const r=n.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),Os(n)>e){r.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Os(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class _u{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Xr()?Jr().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await du(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Ds(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return Ds(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function Os(t){return Wt(JSON.stringify({version:2,heartbeats:t})).length}function gu(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function yu(t){fe(new re("platform-logger",e=>new Nl(e),"PRIVATE")),fe(new re("heartbeat",e=>new pu(e),"PRIVATE")),X(ei,Ns,t),X(ei,Ns,"esm2020"),X("fire-js","")}yu("");var vu="firebase",Eu="12.6.0";X(vu,Eu,"app");const co="@firebase/installations",Si="0.6.19";const lo=1e4,uo=`w:${Si}`,ho="FIS_v2",bu="https://firebaseinstallations.googleapis.com/v1",wu=3600*1e3,Cu="installations",Iu="Installations";const Tu={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Ne=new pn(Cu,Iu,Tu);function fo(t){return t instanceof Ce&&t.code.includes("request-failed")}function po({projectId:t}){return`${bu}/projects/${t}/installations`}function mo(t){return{token:t.token,requestStatus:2,expiresIn:ku(t.expiresIn),creationTime:Date.now()}}async function _o(t,e){const i=(await e.json()).error;return Ne.create("request-failed",{requestName:t,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function go({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function Su(t,{refreshToken:e}){const n=go(t);return n.append("Authorization",Ru(e)),n}async function yo(t){const e=await t();return e.status>=500&&e.status<600?t():e}function ku(t){return Number(t.replace("s","000"))}function Ru(t){return`${ho} ${t}`}async function Au({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=po(t),s=go(t),r=e.getImmediate({optional:!0});if(r){const l=await r.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}const o={fid:n,authVersion:ho,appId:t.appId,sdkVersion:uo},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await yo(()=>fetch(i,a));if(c.ok){const l=await c.json();return{fid:l.fid||n,registrationStatus:2,refreshToken:l.refreshToken,authToken:mo(l.authToken)}}else throw await _o("Create Installation",c)}function vo(t){return new Promise(e=>{setTimeout(e,t)})}function Nu(t){return btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")}const xu=/^[cdef][\w-]{21}$/,ii="";function Du(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const n=Pu(t);return xu.test(n)?n:ii}catch{return ii}}function Pu(t){return Nu(t).substr(0,22)}function _n(t){return`${t.appName}!${t.appId}`}const Eo=new Map;function bo(t,e){const n=_n(t);wo(n,e),Ou(n,e)}function wo(t,e){const n=Eo.get(t);if(n)for(const i of n)i(e)}function Ou(t,e){const n=Mu();n&&n.postMessage({key:t,fid:e}),Lu()}let ke=null;function Mu(){return!ke&&"BroadcastChannel"in self&&(ke=new BroadcastChannel("[Firebase] FID Change"),ke.onmessage=t=>{wo(t.data.key,t.data.fid)}),ke}function Lu(){Eo.size===0&&ke&&(ke.close(),ke=null)}const Fu="firebase-installations-database",ju=1,xe="firebase-installations-store";let Dn=null;function ki(){return Dn||(Dn=no(Fu,ju,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(xe)}}})),Dn}async function zt(t,e){const n=_n(t),s=(await ki()).transaction(xe,"readwrite"),r=s.objectStore(xe),o=await r.get(n);return await r.put(e,n),await s.done,(!o||o.fid!==e.fid)&&bo(t,e.fid),e}async function Co(t){const e=_n(t),i=(await ki()).transaction(xe,"readwrite");await i.objectStore(xe).delete(e),await i.done}async function gn(t,e){const n=_n(t),s=(await ki()).transaction(xe,"readwrite"),r=s.objectStore(xe),o=await r.get(n),a=e(o);return a===void 0?await r.delete(n):await r.put(a,n),await s.done,a&&(!o||o.fid!==a.fid)&&bo(t,a.fid),a}async function Ri(t){let e;const n=await gn(t.appConfig,i=>{const s=Bu(i),r=Uu(t,s);return e=r.registrationPromise,r.installationEntry});return n.fid===ii?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}function Bu(t){const e=t||{fid:Du(),registrationStatus:0};return Io(e)}function Uu(t,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Ne.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=$u(t,n);return{installationEntry:n,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Wu(t)}:{installationEntry:e}}async function $u(t,e){try{const n=await Au(t,e);return zt(t.appConfig,n)}catch(n){throw fo(n)&&n.customData.serverCode===409?await Co(t.appConfig):await zt(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}async function Wu(t){let e=await Ms(t.appConfig);for(;e.registrationStatus===1;)await vo(100),e=await Ms(t.appConfig);if(e.registrationStatus===0){const{installationEntry:n,registrationPromise:i}=await Ri(t);return i||n}return e}function Ms(t){return gn(t,e=>{if(!e)throw Ne.create("installation-not-found");return Io(e)})}function Io(t){return Hu(t)?{fid:t.fid,registrationStatus:0}:t}function Hu(t){return t.registrationStatus===1&&t.registrationTime+lo<Date.now()}async function Vu({appConfig:t,heartbeatServiceProvider:e},n){const i=zu(t,n),s=Su(t,n),r=e.getImmediate({optional:!0});if(r){const l=await r.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}const o={installation:{sdkVersion:uo,appId:t.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await yo(()=>fetch(i,a));if(c.ok){const l=await c.json();return mo(l)}else throw await _o("Generate Auth Token",c)}function zu(t,{fid:e}){return`${po(t)}/${e}/authTokens:generate`}async function Ai(t,e=!1){let n;const i=await gn(t.appConfig,r=>{if(!To(r))throw Ne.create("not-registered");const o=r.authToken;if(!e&&Ku(o))return r;if(o.requestStatus===1)return n=Gu(t,e),r;{if(!navigator.onLine)throw Ne.create("app-offline");const a=Qu(r);return n=qu(t,a),a}});return n?await n:i.authToken}async function Gu(t,e){let n=await Ls(t.appConfig);for(;n.authToken.requestStatus===1;)await vo(100),n=await Ls(t.appConfig);const i=n.authToken;return i.requestStatus===0?Ai(t,e):i}function Ls(t){return gn(t,e=>{if(!To(e))throw Ne.create("not-registered");const n=e.authToken;return Xu(n)?{...e,authToken:{requestStatus:0}}:e})}async function qu(t,e){try{const n=await Vu(t,e),i={...e,authToken:n};return await zt(t.appConfig,i),n}catch(n){if(fo(n)&&(n.customData.serverCode===401||n.customData.serverCode===404))await Co(t.appConfig);else{const i={...e,authToken:{requestStatus:0}};await zt(t.appConfig,i)}throw n}}function To(t){return t!==void 0&&t.registrationStatus===2}function Ku(t){return t.requestStatus===2&&!Yu(t)}function Yu(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+wu}function Qu(t){const e={requestStatus:1,requestTime:Date.now()};return{...t,authToken:e}}function Xu(t){return t.requestStatus===1&&t.requestTime+lo<Date.now()}async function Ju(t){const e=t,{installationEntry:n,registrationPromise:i}=await Ri(e);return i?i.catch(console.error):Ai(e).catch(console.error),n.fid}async function Zu(t,e=!1){const n=t;return await ed(n),(await Ai(n,e)).token}async function ed(t){const{registrationPromise:e}=await Ri(t);e&&await e}function td(t){if(!t||!t.options)throw Pn("App Configuration");if(!t.name)throw Pn("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Pn(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}function Pn(t){return Ne.create("missing-app-config-values",{valueName:t})}const So="installations",nd="installations-internal",id=t=>{const e=t.getProvider("app").getImmediate(),n=td(e),i=Ze(e,"heartbeat");return{app:e,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},sd=t=>{const e=t.getProvider("app").getImmediate(),n=Ze(e,So).getImmediate();return{getId:()=>Ju(n),getToken:s=>Zu(n,s)}};function rd(){fe(new re(So,id,"PUBLIC")),fe(new re(nd,sd,"PRIVATE"))}rd();X(co,Si);X(co,Si,"esm2020");const Gt="analytics",od="firebase_id",ad="origin",cd=60*1e3,ld="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ni="https://www.googletagmanager.com/gtag/js";const z=new Ci("@firebase/analytics");const ud={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},Q=new pn("analytics","Analytics",ud);function dd(t){if(!t.startsWith(Ni)){const e=Q.create("invalid-gtag-resource",{gtagURL:t});return z.warn(e.message),""}return t}function ko(t){return Promise.all(t.map(e=>e.catch(n=>n)))}function hd(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy(t,e)),n}function fd(t,e){const n=hd("firebase-js-sdk-policy",{createScriptURL:dd}),i=document.createElement("script"),s=`${Ni}?l=${t}&id=${e}`;i.src=n?n?.createScriptURL(s):s,i.async=!0,document.head.appendChild(i)}function pd(t){let e=[];return Array.isArray(window[t])?e=window[t]:window[t]=e,e}async function md(t,e,n,i,s,r){const o=i[s];try{if(o)await e[o];else{const c=(await ko(n)).find(l=>l.measurementId===s);c&&await e[c.appId]}}catch(a){z.error(a)}t("config",s,r)}async function _d(t,e,n,i,s){try{let r=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await ko(n);for(const c of o){const l=a.find(h=>h.measurementId===c),d=l&&e[l.appId];if(d)r.push(d);else{r=[];break}}}r.length===0&&(r=Object.values(e)),await Promise.all(r),t("event",i,s||{})}catch(r){z.error(r)}}function gd(t,e,n,i){async function s(r,...o){try{if(r==="event"){const[a,c]=o;await _d(t,e,n,a,c)}else if(r==="config"){const[a,c]=o;await md(t,e,n,i,a,c)}else if(r==="consent"){const[a,c]=o;t("consent",a,c)}else if(r==="get"){const[a,c,l]=o;t("get",a,c,l)}else if(r==="set"){const[a]=o;t("set",a)}else t(r,...o)}catch(a){z.error(a)}}return s}function yd(t,e,n,i,s){let r=function(...o){window[i].push(arguments)};return window[s]&&typeof window[s]=="function"&&(r=window[s]),window[s]=gd(r,t,e,n),{gtagCore:r,wrappedGtag:window[s]}}function vd(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Ni)&&n.src.includes(t))return n;return null}const Ed=30,bd=1e3;class wd{constructor(e={},n=bd){this.throttleMetadata=e,this.intervalMillis=n}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,n){this.throttleMetadata[e]=n}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Ro=new wd;function Cd(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Id(t){const{appId:e,apiKey:n}=t,i={method:"GET",headers:Cd(n)},s=ld.replace("{app-id}",e),r=await fetch(s,i);if(r.status!==200&&r.status!==304){let o="";try{const a=await r.json();a.error?.message&&(o=a.error.message)}catch{}throw Q.create("config-fetch-failed",{httpStatus:r.status,responseMessage:o})}return r.json()}async function Td(t,e=Ro,n){const{appId:i,apiKey:s,measurementId:r}=t.options;if(!i)throw Q.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Q.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Rd;return setTimeout(async()=>{a.abort()},cd),Ao({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Ao(t,{throttleEndTimeMillis:e,backoffCount:n},i,s=Ro){const{appId:r,measurementId:o}=t;try{await Sd(i,e)}catch(a){if(o)return z.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${a?.message}]`),{appId:r,measurementId:o};throw a}try{const a=await Id(t);return s.deleteThrottleMetadata(r),a}catch(a){const c=a;if(!kd(c)){if(s.deleteThrottleMetadata(r),o)return z.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${o} provided in the "measurementId" field in the local Firebase config. [${c?.message}]`),{appId:r,measurementId:o};throw a}const l=Number(c?.customData?.httpStatus)===503?Ss(n,s.intervalMillis,Ed):Ss(n,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return s.setThrottleMetadata(r,d),z.debug(`Calling attemptFetch again in ${l} millis`),Ao(t,d,i,s)}}function Sd(t,e){return new Promise((n,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(n,s);t.addEventListener(()=>{clearTimeout(r),i(Q.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function kd(t){if(!(t instanceof Ce)||!t.customData)return!1;const e=Number(t.customData.httpStatus);return e===429||e===500||e===503||e===504}class Rd{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Ad(t,e,n,i,s){if(s&&s.global){t("event",n,i);return}else{const r=await e,o={...i,send_to:r};t("event",n,o)}}async function Nd(t,e,n,i){if(i&&i.global){const s={};for(const r of Object.keys(n))s[`user_properties.${r}`]=n[r];return t("set",s),Promise.resolve()}else{const s=await e;t("config",s,{update:!0,user_properties:n})}}async function xd(){if(Xr())try{await Jr()}catch(t){return z.warn(Q.create("indexeddb-unavailable",{errorInfo:t?.toString()}).message),!1}else return z.warn(Q.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Dd(t,e,n,i,s,r,o){const a=Td(t);a.then(u=>{n[u.measurementId]=u.appId,t.options.measurementId&&u.measurementId!==t.options.measurementId&&z.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${u.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(u=>z.error(u)),e.push(a);const c=xd().then(u=>{if(u)return i.getId()}),[l,d]=await Promise.all([a,c]);vd(r)||fd(r,l.measurementId),s("js",new Date);const h=o?.config??{};return h[ad]="firebase",h.update=!0,d!=null&&(h[od]=d),s("config",l.measurementId,h),l.measurementId}class Pd{constructor(e){this.app=e}_delete(){return delete $e[this.app.options.appId],Promise.resolve()}}let $e={},Fs=[];const js={};let On="dataLayer",Od="gtag",Bs,xi,Us=!1;function Md(){const t=[];if(Qc()&&t.push("This is a browser extension environment."),Zc()||t.push("Cookies are not available."),t.length>0){const e=t.map((i,s)=>`(${s+1}) ${i}`).join(" "),n=Q.create("invalid-analytics-context",{errorInfo:e});z.warn(n.message)}}function Ld(t,e,n){Md();const i=t.options.appId;if(!i)throw Q.create("no-app-id");if(!t.options.apiKey)if(t.options.measurementId)z.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Q.create("no-api-key");if($e[i]!=null)throw Q.create("already-exists",{id:i});if(!Us){pd(On);const{wrappedGtag:r,gtagCore:o}=yd($e,Fs,js,On,Od);xi=r,Bs=o,Us=!0}return $e[i]=Dd(t,Fs,js,e,Bs,On,n),new Pd(t)}function Fd(t=Ti()){t=ae(t);const e=Ze(t,Gt);return e.isInitialized()?e.getImmediate():jd(t)}function jd(t,e={}){const n=Ze(t,Gt);if(n.isInitialized()){const s=n.getImmediate();if(yt(e,n.getOptions()))return s;throw Q.create("already-initialized")}return n.initialize({options:e})}function Bd(t,e,n){t=ae(t),Nd(xi,$e[t.app.options.appId],e,n).catch(i=>z.error(i))}function Ud(t,e,n,i){t=ae(t),Ad(xi,$e[t.app.options.appId],e,n,i).catch(s=>z.error(s))}const $s="@firebase/analytics",Ws="0.10.19";function $d(){fe(new re(Gt,(e,{options:n})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return Ld(i,s,n)},"PUBLIC")),fe(new re("analytics-internal",t,"PRIVATE")),X($s,Ws),X($s,Ws,"esm2020");function t(e){try{const n=e.getProvider(Gt).getImmediate();return{logEvent:(i,s,r)=>Ud(n,i,s,r),setUserProperties:(i,s)=>Bd(n,i,s)}}catch(n){throw Q.create("interop-component-reg-failed",{reason:n})}}}$d();var Hs={};const Vs="@firebase/database",zs="1.1.0";let No="";function Wd(t){No=t}class Hd{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),B(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:gt(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Vd{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return _e(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const xo=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Hd(e)}}catch{}return new Vd},Re=xo("localStorage"),zd=xo("sessionStorage");const We=new Ci("@firebase/database"),Gd=(function(){let t=1;return function(){return t++}})(),Do=function(t){const e=al(t),n=new ol;n.update(e);const i=n.digest();return bi.encodeByteArray(i)},St=function(...t){let e="";for(let n=0;n<t.length;n++){const i=t[n];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=St.apply(null,i):typeof i=="object"?e+=B(i):e+=i,e+=" "}return e};let dt=null,Gs=!0;const qd=function(t,e){m(!0,"Can't turn on custom loggers persistently."),We.logLevel=x.VERBOSE,dt=We.log.bind(We)},V=function(...t){if(Gs===!0&&(Gs=!1,dt===null&&zd.get("logging_enabled")===!0&&qd()),dt){const e=St.apply(null,t);dt(e)}},kt=function(t){return function(...e){V(t,...e)}},si=function(...t){const e="FIREBASE INTERNAL ERROR: "+St(...t);We.error(e)},pe=function(...t){const e=`FIREBASE FATAL ERROR: ${St(...t)}`;throw We.error(e),new Error(e)},K=function(...t){const e="FIREBASE WARNING: "+St(...t);We.warn(e)},Kd=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&K("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Po=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Yd=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},qe="[MIN_NAME]",De="[MAX_NAME]",et=function(t,e){if(t===e)return 0;if(t===qe||e===De)return-1;if(e===qe||t===De)return 1;{const n=qs(t),i=qs(e);return n!==null?i!==null?n-i===0?t.length-e.length:n-i:-1:i!==null?1:t<e?-1:1}},Qd=function(t,e){return t===e?0:t<e?-1:1},rt=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+B(e))},Di=function(t){if(typeof t!="object"||t===null)return B(t);const e=[];for(const i in t)e.push(i);e.sort();let n="{";for(let i=0;i<e.length;i++)i!==0&&(n+=","),n+=B(e[i]),n+=":",n+=Di(t[e[i]]);return n+="}",n},Oo=function(t,e){const n=t.length;if(n<=e)return[t];const i=[];for(let s=0;s<n;s+=e)s+e>n?i.push(t.substring(s,n)):i.push(t.substring(s,s+e));return i};function Y(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Mo=function(t){m(!Po(t),"Invalid JSON number");const e=11,n=52,i=(1<<e-1)-1;let s,r,o,a,c;t===0?(r=0,o=0,s=1/t===-1/0?1:0):(s=t<0,t=Math.abs(t),t>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(t)/Math.LN2),i),r=a+i,o=Math.round(t*Math.pow(2,n-a)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-i-n))));const l=[];for(c=n;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(r%2?1:0),r=Math.floor(r/2);l.push(s?1:0),l.reverse();const d=l.join("");let h="";for(c=0;c<64;c+=8){let u=parseInt(d.substr(c,8),2).toString(16);u.length===1&&(u="0"+u),h=h+u}return h.toLowerCase()},Xd=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Jd=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Zd(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const i=new Error(t+" at "+e._path.toString()+": "+n);return i.code=t.toUpperCase(),i}const eh=new RegExp("^-?(0*)\\d{1,10}$"),th=-2147483648,nh=2147483647,qs=function(t){if(eh.test(t)){const e=Number(t);if(e>=th&&e<=nh)return e}return null},tt=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw K("Exception was thrown by user callback.",n),e},Math.floor(0))}},ih=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ht=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};class sh{constructor(e,n){this.appCheckProvider=n,this.appName=e.name,io(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=n?.getImmediate({optional:!0}),this.appCheck||n?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((n,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){K(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class rh{constructor(e,n,i){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(V("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,i):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',K(e)}}class Bt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Bt.OWNER="owner";const Pi="5",Lo="v",Fo="s",jo="r",Bo="f",Uo=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$o="ls",Wo="p",ri="ac",Ho="websocket",Vo="long_polling";class zo{constructor(e,n,i,s,r=!1,o="",a=!1,c=!1,l=null){this.secure=n,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Re.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Re.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function oh(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function Go(t,e,n){m(typeof e=="string","typeof type must == string"),m(typeof n=="object","typeof params must == object");let i;if(e===Ho)i=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===Vo)i=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);oh(t)&&(n.ns=t.namespace);const s=[];return Y(n,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class ah{constructor(){this.counters_={}}incrementCounter(e,n=1){_e(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return Uc(this.counters_)}}const Mn={},Ln={};function Oi(t){const e=t.toString();return Mn[e]||(Mn[e]=new ah),Mn[e]}function ch(t,e){const n=t.toString();return Ln[n]||(Ln[n]=e()),Ln[n]}class lh{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&tt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Ks="start",uh="close",dh="pLPCommand",hh="pRTLPCB",qo="id",Ko="pw",Yo="ser",fh="cb",ph="seg",mh="ts",_h="d",gh="dframe",Qo=1870,Xo=30,yh=Qo-Xo,vh=25e3,Eh=3e4;class Ue{constructor(e,n,i,s,r,o,a){this.connId=e,this.repoInfo=n,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=kt(e),this.stats_=Oi(n),this.urlFn=c=>(this.appCheckToken&&(c[ri]=this.appCheckToken),Go(n,Vo,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new lh(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Eh)),Yd(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Mi((...r)=>{const[o,a,c,l,d]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Ks)this.id=a,this.password=c;else if(o===uh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[Ks]="t",i[Yo]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[fh]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Lo]=Pi,this.transportSessionId&&(i[Fo]=this.transportSessionId),this.lastSessionId&&(i[$o]=this.lastSessionId),this.applicationId&&(i[Wo]=this.applicationId),this.appCheckToken&&(i[ri]=this.appCheckToken),typeof location<"u"&&location.hostname&&Uo.test(location.hostname)&&(i[jo]=Bo);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ue.forceAllow_=!0}static forceDisallow(){Ue.forceDisallow_=!0}static isAvailable(){return Ue.forceAllow_?!0:!Ue.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Xd()&&!Jd()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=B(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=Wr(n),s=Oo(i,yh);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const i={};i[gh]="t",i[qo]=e,i[Ko]=n,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=B(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class Mi{constructor(e,n,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Gd(),window[dh+this.uniqueCallbackIdentifier]=e,window[hh+this.uniqueCallbackIdentifier]=n,this.myIFrame=Mi.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){V("frame writing exception"),a.stack&&V(a.stack),V(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||V("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[qo]=this.myID,e[Ko]=this.myPW,e[Yo]=this.currentSerial;let n=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Xo+i.length<=Qo;){const o=this.pendingSegs.shift();i=i+"&"+ph+s+"="+o.seg+"&"+mh+s+"="+o.ts+"&"+_h+s+"="+o.d,s++}return n=n+i,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,i){this.pendingSegs.push({seg:e,ts:n,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const i=()=>{this.outstandingRequests.delete(n),this.newRequest_()},s=setTimeout(i,Math.floor(vh)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),n())},i.onerror=()=>{V("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}const bh=16384,wh=45e3;let qt=null;typeof MozWebSocket<"u"?qt=MozWebSocket:typeof WebSocket<"u"&&(qt=WebSocket);class Z{constructor(e,n,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=kt(this.connId),this.stats_=Oi(n),this.connURL=Z.connectionURL_(n,o,a,s,i),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,i,s,r){const o={};return o[Lo]=Pi,typeof location<"u"&&location.hostname&&Uo.test(location.hostname)&&(o[jo]=Bo),n&&(o[Fo]=n),i&&(o[$o]=i),s&&(o[ri]=s),r&&(o[Wo]=r),Go(e,Ho,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Re.set("previous_websocket_failure",!0);try{let i;Jc(),this.mySock=new qt(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Z.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(n);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&qt!==null&&!Z.forceDisallow_}static previouslyFailed(){return Re.isInMemoryStorage||Re.get("previous_websocket_failure")===!0}markConnectionHealthy(){Re.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const i=gt(n);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(m(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const i=this.extractFrameCount_(n);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const n=B(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const i=Oo(n,bh);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(wh))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Z.responsesRequiredToBeHealthy=2;Z.healthyTimeout=3e4;class Et{static get ALL_TRANSPORTS(){return[Ue,Z]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const n=Z&&Z.isAvailable();let i=n&&!Z.previouslyFailed();if(e.webSocketOnly&&(n||K("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Z];else{const s=this.transports_=[];for(const r of Et.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);Et.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Et.globalTransportInitialized_=!1;const Ch=6e4,Ih=5e3,Th=10*1024,Sh=100*1024,Fn="t",Ys="d",kh="s",Qs="r",Rh="e",Xs="o",Js="a",Zs="n",er="p",Ah="h";class Nh{constructor(e,n,i,s,r,o,a,c,l,d){this.id=e,this.repoInfo_=n,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=kt("c:"+this.id+":"),this.transportManager_=new Et(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ht(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Sh?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Th?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Fn in e){const n=e[Fn];n===Js?this.upgradeIfSecondaryHealthy_():n===Qs?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===Xs&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=rt("t",e),i=rt("d",e);if(n==="c")this.onSecondaryControl_(i);else if(n==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:er,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Js,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Zs,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=rt("t",e),i=rt("d",e);n==="c"?this.onControl_(i):n==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=rt(Fn,e);if(Ys in e){const i=e[Ys];if(n===Ah){const s={...i};this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(n===Zs){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===kh?this.onConnectionShutdown_(i):n===Qs?this.onReset_(i):n===Rh?si("Server Error: "+i):n===Xs?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):si("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),Pi!==i&&K("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,i),ht(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ch))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ht(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Ih))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:er,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Re.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Jo{put(e,n,i,s){}merge(e,n,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,i){}onDisconnectMerge(e,n,i){}onDisconnectCancel(e,n){}reportStats(e){}}class Zo{constructor(e){this.allowedEvents_=e,this.listeners_={},m(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,n)}}on(e,n,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:i});const s=this.getInitialEvent(e);s&&n.apply(i,s)}off(e,n,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===n&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){m(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}class Kt extends Zo{static getInstance(){return new Kt}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Qr()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return m(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const tr=32,nr=768;class N{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function A(){return new N("")}function I(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function be(t){return t.pieces_.length-t.pieceNum_}function D(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new N(t.pieces_,e)}function ea(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function xh(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function ta(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function na(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new N(e,0)}function L(t,e){const n=[];for(let i=t.pieceNum_;i<t.pieces_.length;i++)n.push(t.pieces_[i]);if(e instanceof N)for(let i=e.pieceNum_;i<e.pieces_.length;i++)n.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&n.push(i[s])}return new N(n,0)}function S(t){return t.pieceNum_>=t.pieces_.length}function G(t,e){const n=I(t),i=I(e);if(n===null)return e;if(n===i)return G(D(t),D(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function Li(t,e){if(be(t)!==be(e))return!1;for(let n=t.pieceNum_,i=e.pieceNum_;n<=t.pieces_.length;n++,i++)if(t.pieces_[n]!==e.pieces_[i])return!1;return!0}function ee(t,e){let n=t.pieceNum_,i=e.pieceNum_;if(be(t)>be(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[i])return!1;++n,++i}return!0}class Dh{constructor(e,n){this.errorPrefix_=n,this.parts_=ta(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=mn(this.parts_[i]);ia(this)}}function Ph(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=mn(e),ia(t)}function Oh(t){const e=t.parts_.pop();t.byteLength_-=mn(e),t.parts_.length>0&&(t.byteLength_-=1)}function ia(t){if(t.byteLength_>nr)throw new Error(t.errorPrefix_+"has a key path longer than "+nr+" bytes ("+t.byteLength_+").");if(t.parts_.length>tr)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+tr+") or object contains a cycle "+Se(t))}function Se(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}class Fi extends Zo{static getInstance(){return new Fi}constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return m(e==="visible","Unknown event type: "+e),[this.visible_]}}const ot=1e3,Mh=300*1e3,ir=30*1e3,Lh=1.3,Fh=3e4,jh="server_kill",sr=3;class de extends Jo{constructor(e,n,i,s,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=de.nextPersistentConnectionId_++,this.log_=kt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=ot,this.maxReconnectDelay_=Mh,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Fi.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Kt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const s=++this.requestNumber_,r={r:s,a:e,b:n};this.log_(B(r)),m(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const n=new hn,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?n.resolve(a):n.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),m(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),m(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(i)})}sendListen_(e){const n=e.query,i=n._path.toString(),s=n._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const c=a.d,l=a.s;de.warnOnListenWarnings_(c,n),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(l,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&_e(e,"w")){const i=Ge(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();K(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||sl(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ir)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=il(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(n,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,i=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,i)})}unlisten(e,n){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),m(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,n)}sendUnlisten_(e,n,i,s){this.log_("Unlisten on "+e+" for "+n);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:i})}onDisconnectMerge(e,n,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:i})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,i,s){const r={p:n,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,n,i,s){this.putInternal("p",e,n,i,s)}merge(e,n,i,s){this.putInternal("m",e,n,i,s)}putInternal(e,n,i,s,r){this.initConnection_();const o={p:n,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,i,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+B(e));const n=e.r,i=this.requestCBHash_[n];i&&(delete this.requestCBHash_[n],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):si("Unrecognized action received from server: "+B(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){m(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=ot,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=ot,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Fh&&(this.reconnectDelay_=ot),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Lh)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+de.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(h){m(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:l};const d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,u]=await Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);o?V("getToken() completed but was canceled"):(V("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=u&&u.token,a=new Nh(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,f=>{K(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(jh)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&K(h),c())}}}interrupt(e){V("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){V("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Is(this.interruptReasons_)&&(this.reconnectDelay_=ot,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let i;n?i=n.map(r=>Di(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,n){const i=new N(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(n),r.delete(n),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,n){V("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=sr&&(this.reconnectDelay_=ir,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){V("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=sr&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+No.replace(/\./g,"-")]=1,Qr()?e["framework.cordova"]=1:Xc()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Kt.getInstance().currentlyOnline();return Is(this.interruptReasons_)&&e}}de.nextPersistentConnectionId_=0;de.nextConnectionId_=0;class T{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new T(e,n)}}class yn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const i=new T(qe,e),s=new T(qe,n);return this.compare(i,s)!==0}minPost(){return T.MIN}}let Pt;class sa extends yn{static get __EMPTY_NODE(){return Pt}static set __EMPTY_NODE(e){Pt=e}compare(e,n){return et(e.name,n.name)}isDefinedOn(e){throw Je("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return T.MIN}maxPost(){return new T(De,Pt)}makePost(e,n){return m(typeof e=="string","KeyIndex indexValue must always be a string."),new T(e,Pt)}toString(){return".key"}}const He=new sa;class Ot{constructor(e,n,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?i(e.key,n):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class j{constructor(e,n,i,s,r){this.key=e,this.value=n,this.color=i??j.RED,this.left=s??q.EMPTY_NODE,this.right=r??q.EMPTY_NODE}copy(e,n,i,s,r){return new j(e??this.key,n??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,n,i),null):r===0?s=s.copy(null,n,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,n,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return q.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let i,s;if(i=this,n(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),n(e,i.key)===0){if(i.right.isEmpty())return q.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,j.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,j.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}j.RED=!0;j.BLACK=!1;class Bh{copy(e,n,i,s,r){return this}insert(e,n,i){return new j(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class q{constructor(e,n=q.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new q(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,j.BLACK,null,null))}remove(e){return new q(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,j.BLACK,null,null))}get(e){let n,i=this.root_;for(;!i.isEmpty();){if(n=this.comparator_(e,i.key),n===0)return i.value;n<0?i=i.left:n>0&&(i=i.right)}return null}getPredecessorKey(e){let n,i=this.root_,s=null;for(;!i.isEmpty();)if(n=this.comparator_(e,i.key),n===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else n<0?i=i.left:n>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ot(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new Ot(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new Ot(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new Ot(this.root_,null,this.comparator_,!0,e)}}q.EMPTY_NODE=new Bh;function Uh(t,e){return et(t.name,e.name)}function ji(t,e){return et(t,e)}let oi;function $h(t){oi=t}const ra=function(t){return typeof t=="number"?"number:"+Mo(t):"string:"+t},oa=function(t){if(t.isLeafNode()){const e=t.val();m(typeof e=="string"||typeof e=="number"||typeof e=="object"&&_e(e,".sv"),"Priority must be a string or number.")}else m(t===oi||t.isEmpty(),"priority of unexpected type.");m(t===oi||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let rr;class F{static set __childrenNodeConstructor(e){rr=e}static get __childrenNodeConstructor(){return rr}constructor(e,n=F.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,m(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),oa(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new F(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:F.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return S(e)?this:I(e)===".priority"?this.priorityNode_:F.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:F.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const i=I(e);return i===null?n:n.isEmpty()&&i!==".priority"?this:(m(i!==".priority"||be(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,F.__childrenNodeConstructor.EMPTY_NODE.updateChild(D(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+ra(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Mo(this.value_):e+=this.value_,this.lazyHash_=Do(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===F.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof F.__childrenNodeConstructor?-1:(m(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,s=F.VALUE_TYPE_ORDER.indexOf(n),r=F.VALUE_TYPE_ORDER.indexOf(i);return m(s>=0,"Unknown leaf type: "+n),m(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}F.VALUE_TYPE_ORDER=["object","boolean","number","string"];let aa,ca;function Wh(t){aa=t}function Hh(t){ca=t}class Vh extends yn{compare(e,n){const i=e.node.getPriority(),s=n.node.getPriority(),r=i.compareTo(s);return r===0?et(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return T.MIN}maxPost(){return new T(De,new F("[PRIORITY-POST]",ca))}makePost(e,n){const i=aa(e);return new T(n,new F("[PRIORITY-POST]",i))}toString(){return".priority"}}const O=new Vh;const zh=Math.log(2);class Gh{constructor(e){const n=r=>parseInt(Math.log(r)/zh,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Yt=function(t,e,n,i){t.sort(e);const s=function(c,l){const d=l-c;let h,u;if(d===0)return null;if(d===1)return h=t[c],u=n?n(h):h,new j(u,h.node,j.BLACK,null,null);{const f=parseInt(d/2,10)+c,_=s(c,f),v=s(f+1,l);return h=t[f],u=n?n(h):h,new j(u,h.node,j.BLACK,_,v)}},r=function(c){let l=null,d=null,h=t.length;const u=function(_,v){const b=h-_,M=h;h-=_;const y=s(b+1,M),w=t[b],R=n?n(w):w;f(new j(R,w.node,v,null,y))},f=function(_){l?(l.left=_,l=_):(d=_,l=_)};for(let _=0;_<c.count;++_){const v=c.nextBitIsOne(),b=Math.pow(2,c.count-(_+1));v?u(b,j.BLACK):(u(b,j.BLACK),u(b,j.RED))}return d},o=new Gh(t.length),a=r(o);return new q(i||e,a)};let jn;const Be={};class ue{static get Default(){return m(Be&&O,"ChildrenNode.ts has not been loaded"),jn=jn||new ue({".priority":Be},{".priority":O}),jn}constructor(e,n){this.indexes_=e,this.indexSet_=n}get(e){const n=Ge(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof q?n:null}hasIndex(e){return _e(this.indexSet_,e.toString())}addIndex(e,n){m(e!==He,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=n.getIterator(T.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=Yt(i,e.getCompare()):a=Be;const c=e.toString(),l={...this.indexSet_};l[c]=e;const d={...this.indexes_};return d[c]=a,new ue(d,l)}addToIndexes(e,n){const i=Ht(this.indexes_,(s,r)=>{const o=Ge(this.indexSet_,r);if(m(o,"Missing index implementation for "+r),s===Be)if(o.isDefinedOn(e.node)){const a=[],c=n.getIterator(T.Wrap);let l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Yt(a,o.getCompare())}else return Be;else{const a=n.get(e.name);let c=s;return a&&(c=c.remove(new T(e.name,a))),c.insert(e,e.node)}});return new ue(i,this.indexSet_)}removeFromIndexes(e,n){const i=Ht(this.indexes_,s=>{if(s===Be)return s;{const r=n.get(e.name);return r?s.remove(new T(e.name,r)):s}});return new ue(i,this.indexSet_)}}let at;class E{static get EMPTY_NODE(){return at||(at=new E(new q(ji),null,ue.Default))}constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&oa(this.priorityNode_),this.children_.isEmpty()&&m(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||at}updatePriority(e){return this.children_.isEmpty()?this:new E(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?at:n}}getChild(e){const n=I(e);return n===null?this:this.getImmediateChild(n).getChild(D(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(m(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const i=new T(e,n);let s,r;n.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?at:this.priorityNode_;return new E(s,o,r)}}updateChild(e,n){const i=I(e);if(i===null)return n;{m(I(e)!==".priority"||be(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(D(e),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let i=0,s=0,r=!0;if(this.forEachChild(O,(o,a)=>{n[o]=a.val(e),i++,r&&E.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const a in n)o[a]=n[a];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+ra(this.getPriority().val())+":"),this.forEachChild(O,(n,i)=>{const s=i.hash();s!==""&&(e+=":"+n+":"+s)}),this.lazyHash_=e===""?"":Do(e)}return this.lazyHash_}getPredecessorChildName(e,n,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new T(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new T(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const i=n.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new T(n,this.children_.get(n)):null}forEachChild(e,n){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>n(s.name,s.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,T.Wrap);let r=s.peek();for(;r!=null&&n.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const i=this.resolveIndex_(n);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,T.Wrap);let r=s.peek();for(;r!=null&&n.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Rt?-1:0}withIndex(e){if(e===He||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new E(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===He||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const i=this.getIterator(O),s=n.getIterator(O);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===He?null:this.indexMap_.get(e.toString())}}E.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class qh extends E{constructor(){super(new q(ji),E.EMPTY_NODE,ue.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return E.EMPTY_NODE}isEmpty(){return!1}}const Rt=new qh;Object.defineProperties(T,{MIN:{value:new T(qe,E.EMPTY_NODE)},MAX:{value:new T(De,Rt)}});sa.__EMPTY_NODE=E.EMPTY_NODE;F.__childrenNodeConstructor=E;$h(Rt);Hh(Rt);const Kh=!0;function W(t,e=null){if(t===null)return E.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),m(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new F(n,W(e))}if(!(t instanceof Array)&&Kh){const n=[];let i=!1;if(Y(t,(o,a)=>{if(o.substring(0,1)!=="."){const c=W(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),n.push(new T(o,c)))}}),n.length===0)return E.EMPTY_NODE;const r=Yt(n,Uh,o=>o.name,ji);if(i){const o=Yt(n,O.getCompare());return new E(r,W(e),new ue({".priority":o},{".priority":O}))}else return new E(r,W(e),ue.Default)}else{let n=E.EMPTY_NODE;return Y(t,(i,s)=>{if(_e(t,i)&&i.substring(0,1)!=="."){const r=W(s);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(i,r))}}),n.updatePriority(W(e))}}Wh(W);class Yh extends yn{constructor(e){super(),this.indexPath_=e,m(!S(e)&&I(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const i=this.extractChild(e.node),s=this.extractChild(n.node),r=i.compareTo(s);return r===0?et(e.name,n.name):r}makePost(e,n){const i=W(e),s=E.EMPTY_NODE.updateChild(this.indexPath_,i);return new T(n,s)}maxPost(){const e=E.EMPTY_NODE.updateChild(this.indexPath_,Rt);return new T(De,e)}toString(){return ta(this.indexPath_,0).join("/")}}class Qh extends yn{compare(e,n){const i=e.node.compareTo(n.node);return i===0?et(e.name,n.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return T.MIN}maxPost(){return T.MAX}makePost(e,n){const i=W(e);return new T(n,i)}toString(){return".value"}}const Xh=new Qh;function la(t){return{type:"value",snapshotNode:t}}function Ke(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function bt(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function wt(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function Jh(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}class Bi{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){m(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(bt(n,a)):m(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Ke(n,i)):o.trackChildChange(wt(n,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(n,i).withIndex(this.index_)}updateFullNode(e,n,i){return i!=null&&(e.isLeafNode()||e.forEachChild(O,(s,r)=>{n.hasChild(s)||i.trackChildChange(bt(s,r))}),n.isLeafNode()||n.forEachChild(O,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(wt(s,r,o))}else i.trackChildChange(Ke(s,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?E.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Ct{constructor(e){this.indexedFilter_=new Bi(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Ct.getStartPost_(e),this.endPost_=Ct.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&i}updateChild(e,n,i,s,r,o){return this.matches(new T(n,i))||(i=E.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,i,s,r,o)}updateFullNode(e,n,i){n.isLeafNode()&&(n=E.EMPTY_NODE);let s=n.withIndex(this.index_);s=s.updatePriority(E.EMPTY_NODE);const r=this;return n.forEachChild(O,(o,a)=>{r.matches(new T(o,a))||(s=s.updateImmediateChild(o,E.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}class Zh{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=n=>{const i=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Ct(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,i,s,r,o){return this.rangedFilter_.matches(new T(n,i))||(i=E.EMPTY_NODE),e.getImmediateChild(n).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,i,s,r,o):this.fullLimitUpdateChild_(e,n,i,r,o)}updateFullNode(e,n,i){let s;if(n.isLeafNode()||n.isEmpty())s=E.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){s=E.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=n.withIndex(this.index_),s=s.updatePriority(E.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,E.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(u,f)=>h(f,u)}else o=this.index_.getCompare();const a=e;m(a.numChildren()===this.limit_,"");const c=new T(n,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(c);if(a.hasChild(n)){const h=a.getImmediateChild(n);let u=s.getChildAfterChild(this.index_,l,this.reverse_);for(;u!=null&&(u.name===n||a.hasChild(u.name));)u=s.getChildAfterChild(this.index_,u,this.reverse_);const f=u==null?1:o(u,c);if(d&&!i.isEmpty()&&f>=0)return r?.trackChildChange(wt(n,i,h)),a.updateImmediateChild(n,i);{r?.trackChildChange(bt(n,h));const v=a.updateImmediateChild(n,E.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(r?.trackChildChange(Ke(u.name,u.node)),v.updateImmediateChild(u.name,u.node)):v}}else return i.isEmpty()?e:d&&o(l,c)>=0?(r!=null&&(r.trackChildChange(bt(l.name,l.node)),r.trackChildChange(Ke(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(l.name,E.EMPTY_NODE)):e}}class Ui{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=O}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return m(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return m(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:qe}hasEnd(){return this.endSet_}getIndexEndValue(){return m(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return m(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:De}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return m(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===O}copy(){const e=new Ui;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ef(t){return t.loadsAllData()?new Bi(t.getIndex()):t.hasLimit()?new Zh(t):new Ct(t)}function or(t){const e={};if(t.isDefault())return e;let n;if(t.index_===O?n="$priority":t.index_===Xh?n="$value":t.index_===He?n="$key":(m(t.index_ instanceof Yh,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=B(n),t.startSet_){const i=t.startAfterSet_?"startAfter":"startAt";e[i]=B(t.indexStartValue_),t.startNameSet_&&(e[i]+=","+B(t.indexStartName_))}if(t.endSet_){const i=t.endBeforeSet_?"endBefore":"endAt";e[i]=B(t.indexEndValue_),t.endNameSet_&&(e[i]+=","+B(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function ar(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==O&&(e.i=t.index_.toString()),e}class Qt extends Jo{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(m(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,n,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=kt("p:rest:"),this.listens_={}}listen(e,n,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Qt.getListenId_(e,i),a={};this.listens_[o]=a;const c=or(e._queryParams);this.restRequest_(r+".json",c,(l,d)=>{let h=d;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(r,h,!1,i),Ge(this.listens_,o)===a){let u;l?l===401?u="permission_denied":u="rest_error:"+l:u="ok",s(u,null)}})}unlisten(e,n){const i=Qt.getListenId_(e,n);delete this.listens_[i]}get(e){const n=or(e._queryParams),i=e._path.toString(),s=new hn;return this.restRequest_(i+".json",n,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,n={},i){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(n.auth=s.accessToken),r&&r.token&&(n.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+rl(n);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=gt(a.responseText)}catch{K("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&K("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class tf{constructor(){this.rootNode_=E.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}function Xt(){return{value:null,children:new Map}}function ua(t,e,n){if(S(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const i=I(e);t.children.has(i)||t.children.set(i,Xt());const s=t.children.get(i);e=D(e),ua(s,e,n)}}function ai(t,e,n){t.value!==null?n(e,t.value):nf(t,(i,s)=>{const r=new N(e.toString()+"/"+i);ai(s,r,n)})}function nf(t,e){t.children.forEach((n,i)=>{e(i,n)})}class sf{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n={...e};return this.last_&&Y(this.last_,(i,s)=>{n[i]=n[i]-s}),this.last_=e,n}}const cr=10*1e3,rf=30*1e3,of=300*1e3;class af{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new sf(e);const i=cr+(rf-cr)*Math.random();ht(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),n={};let i=!1;Y(e,(s,r)=>{r>0&&_e(this.statsToReport_,s)&&(n[s]=r,i=!0)}),i&&this.server_.reportStats(n),ht(this.reportStats_.bind(this),Math.floor(Math.random()*2*of))}}var te;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(te||(te={}));function da(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function $i(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Wi(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}class Jt{constructor(e,n,i){this.path=e,this.affectedTree=n,this.revert=i,this.type=te.ACK_USER_WRITE,this.source=da()}operationForChild(e){if(S(this.path)){if(this.affectedTree.value!=null)return m(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new N(e));return new Jt(A(),n,this.revert)}}else return m(I(this.path)===e,"operationForChild called for unrelated child."),new Jt(D(this.path),this.affectedTree,this.revert)}}class It{constructor(e,n){this.source=e,this.path=n,this.type=te.LISTEN_COMPLETE}operationForChild(e){return S(this.path)?new It(this.source,A()):new It(this.source,D(this.path))}}class Pe{constructor(e,n,i){this.source=e,this.path=n,this.snap=i,this.type=te.OVERWRITE}operationForChild(e){return S(this.path)?new Pe(this.source,A(),this.snap.getImmediateChild(e)):new Pe(this.source,D(this.path),this.snap)}}class Tt{constructor(e,n,i){this.source=e,this.path=n,this.children=i,this.type=te.MERGE}operationForChild(e){if(S(this.path)){const n=this.children.subtree(new N(e));return n.isEmpty()?null:n.value?new Pe(this.source,A(),n.value):new Tt(this.source,A(),n)}else return m(I(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Tt(this.source,D(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Oe{constructor(e,n,i){this.node_=e,this.fullyInitialized_=n,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(S(e))return this.isFullyInitialized()&&!this.filtered_;const n=I(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class cf{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function lf(t,e,n,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Jh(o.childName,o.snapshotNode))}),ct(t,s,"child_removed",e,i,n),ct(t,s,"child_added",e,i,n),ct(t,s,"child_moved",r,i,n),ct(t,s,"child_changed",e,i,n),ct(t,s,"value",e,i,n),s}function ct(t,e,n,i,s,r){const o=i.filter(a=>a.type===n);o.sort((a,c)=>df(t,a,c)),o.forEach(a=>{const c=uf(t,a,r);s.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,t.query_))})})}function uf(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function df(t,e,n){if(e.childName==null||n.childName==null)throw Je("Should only compare child_ events.");const i=new T(e.childName,e.snapshotNode),s=new T(n.childName,n.snapshotNode);return t.index_.compare(i,s)}function vn(t,e){return{eventCache:t,serverCache:e}}function ft(t,e,n,i){return vn(new Oe(e,n,i),t.serverCache)}function ha(t,e,n,i){return vn(t.eventCache,new Oe(e,n,i))}function ci(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Me(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}let Bn;const hf=()=>(Bn||(Bn=new q(Qd)),Bn);class P{static fromObject(e){let n=new P(null);return Y(e,(i,s)=>{n=n.set(new N(i),s)}),n}constructor(e,n=hf()){this.value=e,this.children=n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:A(),value:this.value};if(S(e))return null;{const i=I(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(D(e),n);return r!=null?{path:L(new N(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(S(e))return this;{const n=I(e),i=this.children.get(n);return i!==null?i.subtree(D(e)):new P(null)}}set(e,n){if(S(e))return new P(n,this.children);{const i=I(e),r=(this.children.get(i)||new P(null)).set(D(e),n),o=this.children.insert(i,r);return new P(this.value,o)}}remove(e){if(S(e))return this.children.isEmpty()?new P(null):new P(null,this.children);{const n=I(e),i=this.children.get(n);if(i){const s=i.remove(D(e));let r;return s.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,s),this.value===null&&r.isEmpty()?new P(null):new P(this.value,r)}else return this}}get(e){if(S(e))return this.value;{const n=I(e),i=this.children.get(n);return i?i.get(D(e)):null}}setTree(e,n){if(S(e))return n;{const i=I(e),r=(this.children.get(i)||new P(null)).setTree(D(e),n);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new P(this.value,o)}}fold(e){return this.fold_(A(),e)}fold_(e,n){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(L(e,s),n)}),n(e,this.value,i)}findOnPath(e,n){return this.findOnPath_(e,A(),n)}findOnPath_(e,n,i){const s=this.value?i(n,this.value):!1;if(s)return s;if(S(e))return null;{const r=I(e),o=this.children.get(r);return o?o.findOnPath_(D(e),L(n,r),i):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,A(),n)}foreachOnPath_(e,n,i){if(S(e))return this;{this.value&&i(n,this.value);const s=I(e),r=this.children.get(s);return r?r.foreachOnPath_(D(e),L(n,s),i):new P(null)}}foreach(e){this.foreach_(A(),e)}foreach_(e,n){this.children.inorderTraversal((i,s)=>{s.foreach_(L(e,i),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,i)=>{i.value&&e(n,i.value)})}}class ie{constructor(e){this.writeTree_=e}static empty(){return new ie(new P(null))}}function pt(t,e,n){if(S(e))return new ie(new P(n));{const i=t.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=G(s,e);return r=r.updateChild(o,n),new ie(t.writeTree_.set(s,r))}else{const s=new P(n),r=t.writeTree_.setTree(e,s);return new ie(r)}}}function lr(t,e,n){let i=t;return Y(n,(s,r)=>{i=pt(i,L(e,s),r)}),i}function ur(t,e){if(S(e))return ie.empty();{const n=t.writeTree_.setTree(e,new P(null));return new ie(n)}}function li(t,e){return Fe(t,e)!=null}function Fe(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(G(n.path,e)):null}function dr(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(O,(i,s)=>{e.push(new T(i,s))}):t.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new T(i,s.value))}),e}function Ee(t,e){if(S(e))return t;{const n=Fe(t,e);return n!=null?new ie(new P(n)):new ie(t.writeTree_.subtree(e))}}function ui(t){return t.writeTree_.isEmpty()}function Ye(t,e){return fa(A(),t.writeTree_,e)}function fa(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(m(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):n=fa(L(t,s),r,n)}),!n.getChild(t).isEmpty()&&i!==null&&(n=n.updateChild(L(t,".priority"),i)),n}}function Hi(t,e){return ga(e,t)}function ff(t,e,n,i,s){m(i>t.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),t.allWrites.push({path:e,snap:n,writeId:i,visible:s}),s&&(t.visibleWrites=pt(t.visibleWrites,e,n)),t.lastWriteId=i}function pf(t,e){for(let n=0;n<t.allWrites.length;n++){const i=t.allWrites[n];if(i.writeId===e)return i}return null}function mf(t,e){const n=t.allWrites.findIndex(a=>a.writeId===e);m(n>=0,"removeWrite called with nonexistent writeId.");const i=t.allWrites[n];t.allWrites.splice(n,1);let s=i.visible,r=!1,o=t.allWrites.length-1;for(;s&&o>=0;){const a=t.allWrites[o];a.visible&&(o>=n&&_f(a,i.path)?s=!1:ee(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return gf(t),!0;if(i.snap)t.visibleWrites=ur(t.visibleWrites,i.path);else{const a=i.children;Y(a,c=>{t.visibleWrites=ur(t.visibleWrites,L(i.path,c))})}return!0}else return!1}function _f(t,e){if(t.snap)return ee(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&ee(L(t.path,n),e))return!0;return!1}function gf(t){t.visibleWrites=pa(t.allWrites,yf,A()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function yf(t){return t.visible}function pa(t,e,n){let i=ie.empty();for(let s=0;s<t.length;++s){const r=t[s];if(e(r)){const o=r.path;let a;if(r.snap)ee(n,o)?(a=G(n,o),i=pt(i,a,r.snap)):ee(o,n)&&(a=G(o,n),i=pt(i,A(),r.snap.getChild(a)));else if(r.children){if(ee(n,o))a=G(n,o),i=lr(i,a,r.children);else if(ee(o,n))if(a=G(o,n),S(a))i=lr(i,A(),r.children);else{const c=Ge(r.children,I(a));if(c){const l=c.getChild(D(a));i=pt(i,A(),l)}}}else throw Je("WriteRecord should have .snap or .children")}}return i}function ma(t,e,n,i,s){if(!i&&!s){const r=Fe(t.visibleWrites,e);if(r!=null)return r;{const o=Ee(t.visibleWrites,e);if(ui(o))return n;if(n==null&&!li(o,A()))return null;{const a=n||E.EMPTY_NODE;return Ye(o,a)}}}else{const r=Ee(t.visibleWrites,e);if(!s&&ui(r))return n;if(!s&&n==null&&!li(r,A()))return null;{const o=function(l){return(l.visible||s)&&(!i||!~i.indexOf(l.writeId))&&(ee(l.path,e)||ee(e,l.path))},a=pa(t.allWrites,o,e),c=n||E.EMPTY_NODE;return Ye(a,c)}}}function vf(t,e,n){let i=E.EMPTY_NODE;const s=Fe(t.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(O,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(n){const r=Ee(t.visibleWrites,e);return n.forEachChild(O,(o,a)=>{const c=Ye(Ee(r,new N(o)),a);i=i.updateImmediateChild(o,c)}),dr(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=Ee(t.visibleWrites,e);return dr(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Ef(t,e,n,i,s){m(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=L(e,n);if(li(t.visibleWrites,r))return null;{const o=Ee(t.visibleWrites,r);return ui(o)?s.getChild(n):Ye(o,s.getChild(n))}}function bf(t,e,n,i){const s=L(e,n),r=Fe(t.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(n)){const o=Ee(t.visibleWrites,s);return Ye(o,i.getNode().getImmediateChild(n))}else return null}function wf(t,e){return Fe(t.visibleWrites,e)}function Cf(t,e,n,i,s,r,o){let a;const c=Ee(t.visibleWrites,e),l=Fe(c,A());if(l!=null)a=l;else if(n!=null)a=Ye(c,n);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const d=[],h=o.getCompare(),u=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let f=u.getNext();for(;f&&d.length<s;)h(f,i)!==0&&d.push(f),f=u.getNext();return d}else return[]}function If(){return{visibleWrites:ie.empty(),allWrites:[],lastWriteId:-1}}function Zt(t,e,n,i){return ma(t.writeTree,t.treePath,e,n,i)}function Vi(t,e){return vf(t.writeTree,t.treePath,e)}function hr(t,e,n,i){return Ef(t.writeTree,t.treePath,e,n,i)}function en(t,e){return wf(t.writeTree,L(t.treePath,e))}function Tf(t,e,n,i,s,r){return Cf(t.writeTree,t.treePath,e,n,i,s,r)}function zi(t,e,n){return bf(t.writeTree,t.treePath,e,n)}function _a(t,e){return ga(L(t.treePath,e),t.writeTree)}function ga(t,e){return{treePath:t,writeTree:e}}class Sf{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,i=e.childName;m(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),m(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(i,wt(i,e.snapshotNode,s.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(i,bt(i,s.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(i,Ke(i,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(i,wt(i,e.snapshotNode,s.oldSnap));else throw Je("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}class kf{getCompleteChild(e){return null}getChildAfterChild(e,n,i){return null}}const ya=new kf;class Gi{constructor(e,n,i=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=i}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new Oe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return zi(this.writes_,e,i)}}getChildAfterChild(e,n,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Me(this.viewCache_),r=Tf(this.writes_,s,n,1,i,e);return r.length===0?null:r[0]}}function Rf(t){return{filter:t}}function Af(t,e){m(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),m(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function Nf(t,e,n,i,s){const r=new Sf;let o,a;if(n.type===te.OVERWRITE){const l=n;l.source.fromUser?o=di(t,e,l.path,l.snap,i,s,r):(m(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!S(l.path),o=tn(t,e,l.path,l.snap,i,s,a,r))}else if(n.type===te.MERGE){const l=n;l.source.fromUser?o=Df(t,e,l.path,l.children,i,s,r):(m(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=hi(t,e,l.path,l.children,i,s,a,r))}else if(n.type===te.ACK_USER_WRITE){const l=n;l.revert?o=Mf(t,e,l.path,i,s,r):o=Pf(t,e,l.path,l.affectedTree,i,s,r)}else if(n.type===te.LISTEN_COMPLETE)o=Of(t,e,n.path,i,r);else throw Je("Unknown operation type: "+n.type);const c=r.getChanges();return xf(e,o,c),{viewCache:o,changes:c}}function xf(t,e,n){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=ci(t);(n.length>0||!t.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(la(ci(e)))}}function va(t,e,n,i,s,r){const o=e.eventCache;if(en(i,n)!=null)return e;{let a,c;if(S(n))if(m(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=Me(e),d=l instanceof E?l:E.EMPTY_NODE,h=Vi(i,d);a=t.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const l=Zt(i,Me(e));a=t.filter.updateFullNode(e.eventCache.getNode(),l,r)}else{const l=I(n);if(l===".priority"){m(be(n)===1,"Can't have a priority with additional path components");const d=o.getNode();c=e.serverCache.getNode();const h=hr(i,n,d,c);h!=null?a=t.filter.updatePriority(d,h):a=o.getNode()}else{const d=D(n);let h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const u=hr(i,n,o.getNode(),c);u!=null?h=o.getNode().getImmediateChild(l).updateChild(d,u):h=o.getNode().getImmediateChild(l)}else h=zi(i,l,e.serverCache);h!=null?a=t.filter.updateChild(o.getNode(),l,h,d,s,r):a=o.getNode()}}return ft(e,a,o.isFullyInitialized()||S(n),t.filter.filtersNodes())}}function tn(t,e,n,i,s,r,o,a){const c=e.serverCache;let l;const d=o?t.filter:t.filter.getIndexedFilter();if(S(n))l=d.updateFullNode(c.getNode(),i,null);else if(d.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(n,i);l=d.updateFullNode(c.getNode(),f,null)}else{const f=I(n);if(!c.isCompleteForPath(n)&&be(n)>1)return e;const _=D(n),b=c.getNode().getImmediateChild(f).updateChild(_,i);f===".priority"?l=d.updatePriority(c.getNode(),b):l=d.updateChild(c.getNode(),f,b,_,ya,null)}const h=ha(e,l,c.isFullyInitialized()||S(n),d.filtersNodes()),u=new Gi(s,h,r);return va(t,h,n,s,u,a)}function di(t,e,n,i,s,r,o){const a=e.eventCache;let c,l;const d=new Gi(s,e,r);if(S(n))l=t.filter.updateFullNode(e.eventCache.getNode(),i,o),c=ft(e,l,!0,t.filter.filtersNodes());else{const h=I(n);if(h===".priority")l=t.filter.updatePriority(e.eventCache.getNode(),i),c=ft(e,l,a.isFullyInitialized(),a.isFiltered());else{const u=D(n),f=a.getNode().getImmediateChild(h);let _;if(S(u))_=i;else{const v=d.getCompleteChild(h);v!=null?ea(u)===".priority"&&v.getChild(na(u)).isEmpty()?_=v:_=v.updateChild(u,i):_=E.EMPTY_NODE}if(f.equals(_))c=e;else{const v=t.filter.updateChild(a.getNode(),h,_,u,d,o);c=ft(e,v,a.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function fr(t,e){return t.eventCache.isCompleteForChild(e)}function Df(t,e,n,i,s,r,o){let a=e;return i.foreach((c,l)=>{const d=L(n,c);fr(e,I(d))&&(a=di(t,a,d,l,s,r,o))}),i.foreach((c,l)=>{const d=L(n,c);fr(e,I(d))||(a=di(t,a,d,l,s,r,o))}),a}function pr(t,e,n){return n.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function hi(t,e,n,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;S(n)?l=i:l=new P(null).setTree(n,i);const d=e.serverCache.getNode();return l.children.inorderTraversal((h,u)=>{if(d.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),_=pr(t,f,u);c=tn(t,c,new N(h),_,s,r,o,a)}}),l.children.inorderTraversal((h,u)=>{const f=!e.serverCache.isCompleteForChild(h)&&u.value===null;if(!d.hasChild(h)&&!f){const _=e.serverCache.getNode().getImmediateChild(h),v=pr(t,_,u);c=tn(t,c,new N(h),v,s,r,o,a)}}),c}function Pf(t,e,n,i,s,r,o){if(en(s,n)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(S(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return tn(t,e,n,c.getNode().getChild(n),s,r,a,o);if(S(n)){let l=new P(null);return c.getNode().forEachChild(He,(d,h)=>{l=l.set(new N(d),h)}),hi(t,e,n,l,s,r,a,o)}else return e}else{let l=new P(null);return i.foreach((d,h)=>{const u=L(n,d);c.isCompleteForPath(u)&&(l=l.set(d,c.getNode().getChild(u)))}),hi(t,e,n,l,s,r,a,o)}}function Of(t,e,n,i,s){const r=e.serverCache,o=ha(e,r.getNode(),r.isFullyInitialized()||S(n),r.isFiltered());return va(t,o,n,i,ya,s)}function Mf(t,e,n,i,s,r){let o;if(en(i,n)!=null)return e;{const a=new Gi(i,e,s),c=e.eventCache.getNode();let l;if(S(n)||I(n)===".priority"){let d;if(e.serverCache.isFullyInitialized())d=Zt(i,Me(e));else{const h=e.serverCache.getNode();m(h instanceof E,"serverChildren would be complete if leaf node"),d=Vi(i,h)}d=d,l=t.filter.updateFullNode(c,d,r)}else{const d=I(n);let h=zi(i,d,e.serverCache);h==null&&e.serverCache.isCompleteForChild(d)&&(h=c.getImmediateChild(d)),h!=null?l=t.filter.updateChild(c,d,h,D(n),a,r):e.eventCache.getNode().hasChild(d)?l=t.filter.updateChild(c,d,E.EMPTY_NODE,D(n),a,r):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Zt(i,Me(e)),o.isLeafNode()&&(l=t.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||en(i,A())!=null,ft(e,l,o,t.filter.filtersNodes())}}class Lf{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Bi(i.getIndex()),r=ef(i);this.processor_=Rf(r);const o=n.serverCache,a=n.eventCache,c=s.updateFullNode(E.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(E.EMPTY_NODE,a.getNode(),null),d=new Oe(c,o.isFullyInitialized(),s.filtersNodes()),h=new Oe(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=vn(h,d),this.eventGenerator_=new cf(this.query_)}get query(){return this.query_}}function Ff(t){return t.viewCache_.serverCache.getNode()}function jf(t,e){const n=Me(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!S(e)&&!n.getImmediateChild(I(e)).isEmpty())?n.getChild(e):null}function mr(t){return t.eventRegistrations_.length===0}function Bf(t,e){t.eventRegistrations_.push(e)}function _r(t,e,n){const i=[];if(n){m(e==null,"A cancel should cancel all event registrations.");const s=t.query._path;t.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(n,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<t.eventRegistrations_.length;++r){const o=t.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=s}else t.eventRegistrations_=[];return i}function gr(t,e,n,i){e.type===te.MERGE&&e.source.queryId!==null&&(m(Me(t.viewCache_),"We should always have a full cache before handling merges"),m(ci(t.viewCache_),"Missing event cache, even though we have a server cache"));const s=t.viewCache_,r=Nf(t.processor_,s,e,n,i);return Af(t.processor_,r.viewCache),m(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,Ea(t,r.changes,r.viewCache.eventCache.getNode(),null)}function Uf(t,e){const n=t.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(O,(r,o)=>{i.push(Ke(r,o))}),n.isFullyInitialized()&&i.push(la(n.getNode())),Ea(t,i,n.getNode(),e)}function Ea(t,e,n,i){const s=i?[i]:t.eventRegistrations_;return lf(t.eventGenerator_,e,n,s)}let nn;class $f{constructor(){this.views=new Map}}function Wf(t){m(!nn,"__referenceConstructor has already been defined"),nn=t}function Hf(){return m(nn,"Reference.ts has not been loaded"),nn}function Vf(t){return t.views.size===0}function qi(t,e,n,i){const s=e.source.queryId;if(s!==null){const r=t.views.get(s);return m(r!=null,"SyncTree gave us an op for an invalid query."),gr(r,e,n,i)}else{let r=[];for(const o of t.views.values())r=r.concat(gr(o,e,n,i));return r}}function zf(t,e,n,i,s){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let a=Zt(n,s?i:null),c=!1;a?c=!0:i instanceof E?(a=Vi(n,i),c=!1):(a=E.EMPTY_NODE,c=!1);const l=vn(new Oe(a,c,!1),new Oe(i,s,!1));return new Lf(e,l)}return o}function Gf(t,e,n,i,s,r){const o=zf(t,e,i,s,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),Bf(o,n),Uf(o,n)}function qf(t,e,n,i){const s=e._queryIdentifier,r=[];let o=[];const a=we(t);if(s==="default")for(const[c,l]of t.views.entries())o=o.concat(_r(l,n,i)),mr(l)&&(t.views.delete(c),l.query._queryParams.loadsAllData()||r.push(l.query));else{const c=t.views.get(s);c&&(o=o.concat(_r(c,n,i)),mr(c)&&(t.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!we(t)&&r.push(new(Hf())(e._repo,e._path)),{removed:r,events:o}}function ba(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Ve(t,e){let n=null;for(const i of t.views.values())n=n||jf(i,e);return n}function wa(t,e){if(e._queryParams.loadsAllData())return En(t);{const i=e._queryIdentifier;return t.views.get(i)}}function Ca(t,e){return wa(t,e)!=null}function we(t){return En(t)!=null}function En(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let sn;function Kf(t){m(!sn,"__referenceConstructor has already been defined"),sn=t}function Yf(){return m(sn,"Reference.ts has not been loaded"),sn}let Qf=1;class yr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new P(null),this.pendingWriteTree_=If(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ia(t,e,n,i,s){return ff(t.pendingWriteTree_,e,n,i,s),s?At(t,new Pe(da(),e,n)):[]}function Ae(t,e,n=!1){const i=pf(t.pendingWriteTree_,e);if(mf(t.pendingWriteTree_,e)){let r=new P(null);return i.snap!=null?r=r.set(A(),!0):Y(i.children,o=>{r=r.set(new N(o),!0)}),At(t,new Jt(i.path,r,n))}else return[]}function bn(t,e,n){return At(t,new Pe($i(),e,n))}function Xf(t,e,n){const i=P.fromObject(n);return At(t,new Tt($i(),e,i))}function Jf(t,e){return At(t,new It($i(),e))}function Zf(t,e,n){const i=Yi(t,n);if(i){const s=Qi(i),r=s.path,o=s.queryId,a=G(r,e),c=new It(Wi(o),a);return Xi(t,r,c)}else return[]}function fi(t,e,n,i,s=!1){const r=e._path,o=t.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||Ca(o,e))){const c=qf(o,e,n,i);Vf(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const l=c.removed;if(a=c.events,!s){const d=l.findIndex(u=>u._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(r,(u,f)=>we(f));if(d&&!h){const u=t.syncPointTree_.subtree(r);if(!u.isEmpty()){const f=np(u);for(let _=0;_<f.length;++_){const v=f[_],b=v.query,M=ka(t,v);t.listenProvider_.startListening(mt(b),rn(t,b),M.hashFn,M.onComplete)}}}!h&&l.length>0&&!i&&(d?t.listenProvider_.stopListening(mt(e),null):l.forEach(u=>{const f=t.queryToTagMap.get(wn(u));t.listenProvider_.stopListening(mt(u),f)}))}ip(t,l)}return a}function ep(t,e,n,i){const s=Yi(t,i);if(s!=null){const r=Qi(s),o=r.path,a=r.queryId,c=G(o,e),l=new Pe(Wi(a),c,n);return Xi(t,o,l)}else return[]}function tp(t,e,n,i){const s=Yi(t,i);if(s){const r=Qi(s),o=r.path,a=r.queryId,c=G(o,e),l=P.fromObject(n),d=new Tt(Wi(a),c,l);return Xi(t,o,d)}else return[]}function vr(t,e,n,i=!1){const s=e._path;let r=null,o=!1;t.syncPointTree_.foreachOnPath(s,(u,f)=>{const _=G(u,s);r=r||Ve(f,_),o=o||we(f)});let a=t.syncPointTree_.get(s);a?(o=o||we(a),r=r||Ve(a,A())):(a=new $f,t.syncPointTree_=t.syncPointTree_.set(s,a));let c;r!=null?c=!0:(c=!1,r=E.EMPTY_NODE,t.syncPointTree_.subtree(s).foreachChild((f,_)=>{const v=Ve(_,A());v&&(r=r.updateImmediateChild(f,v))}));const l=Ca(a,e);if(!l&&!e._queryParams.loadsAllData()){const u=wn(e);m(!t.queryToTagMap.has(u),"View does not exist, but we have a tag");const f=sp();t.queryToTagMap.set(u,f),t.tagToQueryMap.set(f,u)}const d=Hi(t.pendingWriteTree_,s);let h=Gf(a,e,n,d,r,c);if(!l&&!o&&!i){const u=wa(a,e);h=h.concat(rp(t,e,u))}return h}function Ki(t,e,n){const s=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,a)=>{const c=G(o,e),l=Ve(a,c);if(l)return l});return ma(s,e,r,n,!0)}function At(t,e){return Ta(e,t.syncPointTree_,null,Hi(t.pendingWriteTree_,A()))}function Ta(t,e,n,i){if(S(t.path))return Sa(t,e,n,i);{const s=e.get(A());n==null&&s!=null&&(n=Ve(s,A()));let r=[];const o=I(t.path),a=t.operationForChild(o),c=e.children.get(o);if(c&&a){const l=n?n.getImmediateChild(o):null,d=_a(i,o);r=r.concat(Ta(a,c,l,d))}return s&&(r=r.concat(qi(s,t,i,n))),r}}function Sa(t,e,n,i){const s=e.get(A());n==null&&s!=null&&(n=Ve(s,A()));let r=[];return e.children.inorderTraversal((o,a)=>{const c=n?n.getImmediateChild(o):null,l=_a(i,o),d=t.operationForChild(o);d&&(r=r.concat(Sa(d,a,c,l)))}),s&&(r=r.concat(qi(s,t,i,n))),r}function ka(t,e){const n=e.query,i=rn(t,n);return{hashFn:()=>(Ff(e)||E.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?Zf(t,n._path,i):Jf(t,n._path);{const r=Zd(s,n);return fi(t,n,null,r)}}}}function rn(t,e){const n=wn(e);return t.queryToTagMap.get(n)}function wn(t){return t._path.toString()+"$"+t._queryIdentifier}function Yi(t,e){return t.tagToQueryMap.get(e)}function Qi(t){const e=t.indexOf("$");return m(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new N(t.substr(0,e))}}function Xi(t,e,n){const i=t.syncPointTree_.get(e);m(i,"Missing sync point for query tag that we're tracking");const s=Hi(t.pendingWriteTree_,e);return qi(i,n,s,null)}function np(t){return t.fold((e,n,i)=>{if(n&&we(n))return[En(n)];{let s=[];return n&&(s=ba(n)),Y(i,(r,o)=>{s=s.concat(o)}),s}})}function mt(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Yf())(t._repo,t._path):t}function ip(t,e){for(let n=0;n<e.length;++n){const i=e[n];if(!i._queryParams.loadsAllData()){const s=wn(i),r=t.queryToTagMap.get(s);t.queryToTagMap.delete(s),t.tagToQueryMap.delete(r)}}}function sp(){return Qf++}function rp(t,e,n){const i=e._path,s=rn(t,e),r=ka(t,n),o=t.listenProvider_.startListening(mt(e),s,r.hashFn,r.onComplete),a=t.syncPointTree_.subtree(i);if(s)m(!we(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((l,d,h)=>{if(!S(l)&&d&&we(d))return[En(d).query];{let u=[];return d&&(u=u.concat(ba(d).map(f=>f.query))),Y(h,(f,_)=>{u=u.concat(_)}),u}});for(let l=0;l<c.length;++l){const d=c[l];t.listenProvider_.stopListening(mt(d),rn(t,d))}}return o}class Ji{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new Ji(n)}node(){return this.node_}}class Zi{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=L(this.path_,e);return new Zi(this.syncTree_,n)}node(){return Ki(this.syncTree_,this.path_)}}const op=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},Er=function(t,e,n){if(!t||typeof t!="object")return t;if(m(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return ap(t[".sv"],e,n);if(typeof t[".sv"]=="object")return cp(t[".sv"],e);m(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},ap=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:m(!1,"Unexpected server value: "+t)}},cp=function(t,e,n){t.hasOwnProperty("increment")||m(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const i=t.increment;typeof i!="number"&&m(!1,"Unexpected increment value: "+i);const s=e.node();if(m(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},lp=function(t,e,n,i){return es(e,new Zi(n,t),i)},Ra=function(t,e,n){return es(t,new Ji(e),n)};function es(t,e,n){const i=t.getPriority().val(),s=Er(i,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const o=t,a=Er(o.getValue(),e,n);return a!==o.getValue()||s!==o.getPriority().val()?new F(a,W(s)):t}else{const o=t;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new F(s))),o.forEachChild(O,(a,c)=>{const l=es(c,e.getImmediateChild(a),n);l!==c&&(r=r.updateImmediateChild(a,l))}),r}}class ts{constructor(e="",n=null,i={children:{},childCount:0}){this.name=e,this.parent=n,this.node=i}}function ns(t,e){let n=e instanceof N?e:new N(e),i=t,s=I(n);for(;s!==null;){const r=Ge(i.node.children,s)||{children:{},childCount:0};i=new ts(s,i,r),n=D(n),s=I(n)}return i}function nt(t){return t.node.value}function Aa(t,e){t.node.value=e,pi(t)}function Na(t){return t.node.childCount>0}function up(t){return nt(t)===void 0&&!Na(t)}function Cn(t,e){Y(t.node.children,(n,i)=>{e(new ts(n,t,i))})}function xa(t,e,n,i){n&&e(t),Cn(t,s=>{xa(s,e,!0)})}function dp(t,e,n){let i=t.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Nt(t){return new N(t.parent===null?t.name:Nt(t.parent)+"/"+t.name)}function pi(t){t.parent!==null&&hp(t.parent,t.name,t)}function hp(t,e,n){const i=up(n),s=_e(t.node.children,e);i&&s?(delete t.node.children[e],t.node.childCount--,pi(t)):!i&&!s&&(t.node.children[e]=n.node,t.node.childCount++,pi(t))}const fp=/[\[\].#$\/\u0000-\u001F\u007F]/,pp=/[\[\].#$\u0000-\u001F\u007F]/,Un=10*1024*1024,Da=function(t){return typeof t=="string"&&t.length!==0&&!fp.test(t)},Pa=function(t){return typeof t=="string"&&t.length!==0&&!pp.test(t)},mp=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Pa(t)},Oa=function(t,e,n,i){i&&e===void 0||is(wi(t,"value"),e,n)},is=function(t,e,n){const i=n instanceof N?new Dh(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Se(i));if(typeof e=="function")throw new Error(t+"contains a function "+Se(i)+" with contents = "+e.toString());if(Po(e))throw new Error(t+"contains "+e.toString()+" "+Se(i));if(typeof e=="string"&&e.length>Un/3&&mn(e)>Un)throw new Error(t+"contains a string greater than "+Un+" utf8 bytes "+Se(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Y(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Da(o)))throw new Error(t+" contains an invalid key ("+o+") "+Se(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Ph(i,o),is(t,a,i),Oh(i)}),s&&r)throw new Error(t+' contains ".value" child '+Se(i)+" in addition to actual children.")}},Ma=function(t,e,n,i){if(!Pa(n))throw new Error(wi(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},_p=function(t,e,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ma(t,e,n)},La=function(t,e){if(I(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},gp=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Da(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!mp(n))throw new Error(wi(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class yp{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ss(t,e){let n=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();n!==null&&!Li(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(s)}n&&t.eventLists_.push(n)}function Fa(t,e,n){ss(t,n),ja(t,i=>Li(i,e))}function me(t,e,n){ss(t,n),ja(t,i=>ee(i,e)||ee(e,i))}function ja(t,e){t.recursionDepth_++;let n=!0;for(let i=0;i<t.eventLists_.length;i++){const s=t.eventLists_[i];if(s){const r=s.path;e(r)?(vp(t.eventLists_[i]),t.eventLists_[i]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function vp(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const i=n.getEventRunner();dt&&V("event: "+n.toString()),tt(i)}}}const Ep="repo_interrupt",bp=25;class wp{constructor(e,n,i,s){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new yp,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Xt(),this.transactionQueueTree_=new ts,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Cp(t,e,n){if(t.stats_=Oi(t.repoInfo_),t.forceRestClient_||ih())t.server_=new Qt(t.repoInfo_,(i,s,r,o)=>{br(t,i,s,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>wr(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{B(n)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}t.persistentConnection_=new de(t.repoInfo_,e,(i,s,r,o)=>{br(t,i,s,r,o)},i=>{wr(t,i)},i=>{Ip(t,i)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(i=>{t.server_.refreshAuthToken(i)}),t.appCheckProvider_.addTokenChangeListener(i=>{t.server_.refreshAppCheckToken(i.token)}),t.statsReporter_=ch(t.repoInfo_,()=>new af(t.stats_,t.server_)),t.infoData_=new tf,t.infoSyncTree_=new yr({startListening:(i,s,r,o)=>{let a=[];const c=t.infoData_.getNode(i._path);return c.isEmpty()||(a=bn(t.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),os(t,"connected",!1),t.serverSyncTree_=new yr({startListening:(i,s,r,o)=>(t.server_.listen(i,r,s,(a,c)=>{const l=o(a,c);me(t.eventQueue_,i._path,l)}),[]),stopListening:(i,s)=>{t.server_.unlisten(i,s)}})}function Ba(t){const n=t.infoData_.getNode(new N(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function rs(t){return op({timestamp:Ba(t)})}function br(t,e,n,i,s){t.dataUpdateCount++;const r=new N(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(s)if(i){const c=Ht(n,l=>W(l));o=tp(t.serverSyncTree_,r,c,s)}else{const c=W(n);o=ep(t.serverSyncTree_,r,c,s)}else if(i){const c=Ht(n,l=>W(l));o=Xf(t.serverSyncTree_,r,c)}else{const c=W(n);o=bn(t.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=In(t,r)),me(t.eventQueue_,a,o)}function wr(t,e){os(t,"connected",e),e===!1&&Sp(t)}function Ip(t,e){Y(e,(n,i)=>{os(t,n,i)})}function os(t,e,n){const i=new N("/.info/"+e),s=W(n);t.infoData_.updateSnapshot(i,s);const r=bn(t.infoSyncTree_,i,s);me(t.eventQueue_,i,r)}function Ua(t){return t.nextWriteId_++}function Tp(t,e,n,i,s){as(t,"set",{path:e.toString(),value:n,priority:i});const r=rs(t),o=W(n,i),a=Ki(t.serverSyncTree_,e),c=Ra(o,a,r),l=Ua(t),d=Ia(t.serverSyncTree_,e,c,l,!0);ss(t.eventQueue_,d),t.server_.put(e.toString(),o.val(!0),(u,f)=>{const _=u==="ok";_||K("set at "+e+" failed: "+u);const v=Ae(t.serverSyncTree_,l,!_);me(t.eventQueue_,e,v),Np(t,s,u,f)});const h=za(t,e);In(t,h),me(t.eventQueue_,h,[])}function Sp(t){as(t,"onDisconnectEvents");const e=rs(t),n=Xt();ai(t.onDisconnect_,A(),(s,r)=>{const o=lp(s,r,t.serverSyncTree_,e);ua(n,s,o)});let i=[];ai(n,A(),(s,r)=>{i=i.concat(bn(t.serverSyncTree_,s,r));const o=za(t,s);In(t,o)}),t.onDisconnect_=Xt(),me(t.eventQueue_,A(),i)}function kp(t,e,n){let i;I(e._path)===".info"?i=vr(t.infoSyncTree_,e,n):i=vr(t.serverSyncTree_,e,n),Fa(t.eventQueue_,e._path,i)}function Rp(t,e,n){let i;I(e._path)===".info"?i=fi(t.infoSyncTree_,e,n):i=fi(t.serverSyncTree_,e,n),Fa(t.eventQueue_,e._path,i)}function Ap(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Ep)}function as(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),V(n,...e)}function Np(t,e,n,i){e&&tt(()=>{if(n==="ok")e(null);else{const s=(n||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function $a(t,e,n){return Ki(t.serverSyncTree_,e,n)||E.EMPTY_NODE}function cs(t,e=t.transactionQueueTree_){if(e||Tn(t,e),nt(e)){const n=Ha(t,e);m(n.length>0,"Sending zero length transaction queue"),n.every(s=>s.status===0)&&xp(t,Nt(e),n)}else Na(e)&&Cn(e,n=>{cs(t,n)})}function xp(t,e,n){const i=n.map(l=>l.currentWriteId),s=$a(t,e,i);let r=s;const o=s.hash();for(let l=0;l<n.length;l++){const d=n[l];m(d.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=G(e,d.path);r=r.updateChild(h,d.currentOutputSnapshotRaw)}const a=r.val(!0),c=e;t.server_.put(c.toString(),a,l=>{as(t,"transaction put response",{path:c.toString(),status:l});let d=[];if(l==="ok"){const h=[];for(let u=0;u<n.length;u++)n[u].status=2,d=d.concat(Ae(t.serverSyncTree_,n[u].currentWriteId)),n[u].onComplete&&h.push(()=>n[u].onComplete(null,!0,n[u].currentOutputSnapshotResolved)),n[u].unwatcher();Tn(t,ns(t.transactionQueueTree_,e)),cs(t,t.transactionQueueTree_),me(t.eventQueue_,e,d);for(let u=0;u<h.length;u++)tt(h[u])}else{if(l==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{K("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=l}In(t,e)}},o)}function In(t,e){const n=Wa(t,e),i=Nt(n),s=Ha(t,n);return Dp(t,s,i),i}function Dp(t,e,n){if(e.length===0)return;const i=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],l=G(n,c.path);let d=!1,h;if(m(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)d=!0,h=c.abortReason,s=s.concat(Ae(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=bp)d=!0,h="maxretry",s=s.concat(Ae(t.serverSyncTree_,c.currentWriteId,!0));else{const u=$a(t,c.path,o);c.currentInputSnapshot=u;const f=e[a].update(u.val());if(f!==void 0){is("transaction failed: Data returned ",f,c.path);let _=W(f);typeof f=="object"&&f!=null&&_e(f,".priority")||(_=_.updatePriority(u.getPriority()));const b=c.currentWriteId,M=rs(t),y=Ra(_,u,M);c.currentOutputSnapshotRaw=_,c.currentOutputSnapshotResolved=y,c.currentWriteId=Ua(t),o.splice(o.indexOf(b),1),s=s.concat(Ia(t.serverSyncTree_,c.path,y,c.currentWriteId,c.applyLocally)),s=s.concat(Ae(t.serverSyncTree_,b,!0))}else d=!0,h="nodata",s=s.concat(Ae(t.serverSyncTree_,c.currentWriteId,!0))}me(t.eventQueue_,n,s),s=[],d&&(e[a].status=2,(function(u){setTimeout(u,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Tn(t,t.transactionQueueTree_);for(let a=0;a<i.length;a++)tt(i[a]);cs(t,t.transactionQueueTree_)}function Wa(t,e){let n,i=t.transactionQueueTree_;for(n=I(e);n!==null&&nt(i)===void 0;)i=ns(i,n),e=D(e),n=I(e);return i}function Ha(t,e){const n=[];return Va(t,e,n),n.sort((i,s)=>i.order-s.order),n}function Va(t,e,n){const i=nt(e);if(i)for(let s=0;s<i.length;s++)n.push(i[s]);Cn(e,s=>{Va(t,s,n)})}function Tn(t,e){const n=nt(e);if(n){let i=0;for(let s=0;s<n.length;s++)n[s].status!==2&&(n[i]=n[s],i++);n.length=i,Aa(e,n.length>0?n:void 0)}Cn(e,i=>{Tn(t,i)})}function za(t,e){const n=Nt(Wa(t,e)),i=ns(t.transactionQueueTree_,e);return dp(i,s=>{$n(t,s)}),$n(t,i),xa(i,s=>{$n(t,s)}),n}function $n(t,e){const n=nt(e);if(n){const i=[];let s=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(m(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(m(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),s=s.concat(Ae(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&i.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Aa(e,void 0):n.length=r+1,me(t.eventQueue_,Nt(e),s);for(let o=0;o<i.length;o++)tt(i[o])}}function Pp(t){let e="";const n=t.split("/");for(let i=0;i<n.length;i++)if(n[i].length>0){let s=n[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function Op(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const i=n.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):K(`Invalid query segment '${n}' in query '${t}'`)}return e}const Cr=function(t,e){const n=Mp(t),i=n.namespace;n.domain==="firebase.com"&&pe(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&n.domain!=="localhost"&&pe("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Kd();const s=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new zo(n.host,n.secure,i,s,e,"",i!==n.subdomain),path:new N(n.pathString)}},Mp=function(t){let e="",n="",i="",s="",r="",o=!0,a="https",c=443;if(typeof t=="string"){let l=t.indexOf("//");l>=0&&(a=t.substring(0,l-1),t=t.substring(l+2));let d=t.indexOf("/");d===-1&&(d=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(d,h)),d<h&&(s=Pp(t.substring(d,h)));const u=Op(t.substring(Math.min(t.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{const _=e.indexOf(".");i=e.substring(0,_).toLowerCase(),n=e.substring(_+1),r=i}"ns"in u&&(r=u.ns)}return{host:e,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};const Ir="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Lp=(function(){let t=0;const e=[];return function(n){const i=n===t;t=n;let s;const r=new Array(8);for(s=7;s>=0;s--)r[s]=Ir.charAt(n%64),n=Math.floor(n/64);m(n===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Ir.charAt(e[s]);return m(o.length===20,"nextPushId: Length should be 20."),o}})();class Fp{constructor(e,n,i,s){this.eventType=e,this.eventRegistration=n,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+B(this.snapshot.exportVal())}}class jp{constructor(e,n,i){this.eventRegistration=e,this.error=n,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Bp{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return m(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class ls{constructor(e,n,i,s){this._repo=e,this._path=n,this._queryParams=i,this._orderByCalled=s}get key(){return S(this._path)?null:ea(this._path)}get ref(){return new Ie(this._repo,this._path)}get _queryIdentifier(){const e=ar(this._queryParams),n=Di(e);return n==="{}"?"default":n}get _queryObject(){return ar(this._queryParams)}isEqual(e){if(e=ae(e),!(e instanceof ls))return!1;const n=this._repo===e._repo,i=Li(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return n&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+xh(this._path)}}class Ie extends ls{constructor(e,n){super(e,n,new Ui,!1)}get parent(){const e=na(this._path);return e===null?null:new Ie(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class on{constructor(e,n,i){this._node=e,this.ref=n,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new N(e),i=Qe(this.ref,e);return new on(this._node.getChild(n),i,O)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new on(s,Qe(this.ref,i),O)))}hasChild(e){const n=new N(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function us(t,e){return t=ae(t),t._checkNotDeleted("ref"),e!==void 0?Qe(t._root,e):t._root}function Qe(t,e){return t=ae(t),I(t._path)===null?_p("child","path",e):Ma("child","path",e),new Ie(t._repo,L(t._path,e))}function Up(t,e){t=ae(t),La("push",t._path),Oa("push",e,t._path,!0);const n=Ba(t._repo),i=Lp(n),s=Qe(t,i),r=Qe(t,i);let o;return o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Ga(t,e){t=ae(t),La("set",t._path),Oa("set",e,t._path,!1);const n=new hn;return Tp(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}class ds{constructor(e,n){this.eventType=e,this.callbackContext=n}respondsTo(e){let n=e==="children_added"?"child_added":e;return n=n==="children_removed"?"child_removed":n,this.eventType===n}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new jp(this,e,n):null}createEvent(e,n){m(e.childName!=null,"Child events should have a childName.");const i=Qe(new Ie(n._repo,n._path),e.childName),s=n._queryParams.getIndex();return new Fp(e.type,this,new on(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof ds?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function $p(t,e,n,i,s){const r=new Bp(n,void 0),o=new ds(e,r);return kp(t._repo,t,o),()=>Rp(t._repo,t,o)}function Wp(t,e,n,i){return $p(t,"child_added",e)}Wf(Ie);Kf(Ie);const Hp="FIREBASE_DATABASE_EMULATOR_HOST",mi={};let Vp=!1;function zp(t,e,n,i){const s=e.lastIndexOf(":"),r=e.substring(0,s),o=fn(r);t.repoInfo_=new zo(e,o,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(t.authTokenProvider_=i)}function Gp(t,e,n,i,s){let r=i||t.options.databaseURL;r===void 0&&(t.options.projectId||pe("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),V("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=Cr(r,s),a=o.repoInfo,c;typeof process<"u"&&Hs&&(c=Hs[Hp]),c?(r=`http://${c}?ns=${a.namespace}`,o=Cr(r,s),a=o.repoInfo):o.repoInfo.secure;const l=new rh(t.name,t.options,e);gp("Invalid Firebase Database URL",o),S(o.path)||pe("Database URL must point to the root of a Firebase Database (not including a child path).");const d=Kp(a,t,l,new sh(t,n));return new Yp(d,t)}function qp(t,e){const n=mi[e];(!n||n[t.key]!==t)&&pe(`Database ${e}(${t.repoInfo_}) has already been deleted.`),Ap(t),delete n[t.key]}function Kp(t,e,n,i){let s=mi[e.name];s||(s={},mi[e.name]=s);let r=s[t.toURLString()];return r&&pe("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new wp(t,Vp,n,i),s[t.toURLString()]=r,r}let Yp=class{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Cp(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ie(this._repo,A())),this._rootInternal}_delete(){return this._rootInternal!==null&&(qp(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pe("Cannot call "+e+" on a deleted database.")}};function Qp(t=Ti(),e){const n=Ze(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const i=zr("database");i&&Xp(n,...i)}return n}function Xp(t,e,n,i={}){t=ae(t),t._checkNotDeleted("useEmulator");const s=`${e}:${n}`,r=t._repoInternal;if(t._instanceStarted){if(s===t._repoInternal.repoInfo_.host&&yt(i,r.repoInfo_.emulatorOptions))return;pe("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&pe('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Bt(Bt.OWNER);else if(i.mockUserToken){const a=typeof i.mockUserToken=="string"?i.mockUserToken:Kr(i.mockUserToken,t.app.options.projectId);o=new Bt(a)}fn(e)&&(qr(e),Yr("Database",!0)),zp(r,s,i,o)}function Jp(t){Wd(so),fe(new re("database",(e,{instanceIdentifier:n})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Gp(i,s,r,n)},"PUBLIC").setMultipleInstances(!0)),X(Vs,zs,t),X(Vs,zs,"esm2020")}const Zp={".sv":"timestamp"};function qa(){return Zp}de.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};de.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};Jp();const Ka="firebasestorage.googleapis.com",em="storageBucket",tm=120*1e3,nm=600*1e3;class ce extends Ce{constructor(e,n,i=0){super(Wn(e),`Firebase Storage: ${n} (${Wn(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ce.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Wn(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var oe;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(oe||(oe={}));function Wn(t){return"storage/"+t}function im(){const t="An unknown error occurred, please check the error payload for server response.";return new ce(oe.UNKNOWN,t)}function sm(){return new ce(oe.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function rm(){return new ce(oe.CANCELED,"User canceled the upload/download.")}function om(t){return new ce(oe.INVALID_URL,"Invalid URL '"+t+"'.")}function am(t){return new ce(oe.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function Tr(t){return new ce(oe.INVALID_ARGUMENT,t)}function Ya(){return new ce(oe.APP_DELETED,"The Firebase app was deleted.")}function cm(t){return new ce(oe.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}class ne{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let i;try{i=ne.makeFromUrl(e,n)}catch{return new ne(e,"")}if(i.path==="")return i;throw am(e)}static makeFromUrl(e,n){let i=null;const s="([A-Za-z0-9.\\-_]+)";function r(R){R.path.charAt(R.path.length-1)==="/"&&(R.path_=R.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function l(R){R.path_=decodeURIComponent(R.path)}const d="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),u="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${d}/b/${s}/o${u}`,"i"),_={bucket:1,path:3},v=n===Ka?"(?:storage.googleapis.com|storage.cloud.google.com)":n,b="([^?#]*)",M=new RegExp(`^https?://${v}/${s}/${b}`,"i"),w=[{regex:a,indices:c,postModify:r},{regex:f,indices:_,postModify:l},{regex:M,indices:{bucket:1,path:2},postModify:l}];for(let R=0;R<w.length;R++){const U=w[R],le=U.regex.exec(e);if(le){const xt=le[U.indices.bucket];let st=le[U.indices.path];st||(st=""),i=new ne(xt,st),U.postModify(i);break}}if(i==null)throw om(e);return i}}class lm{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function um(t,e,n){let i=1,s=null,r=null,o=!1,a=0;function c(){return a===2}let l=!1;function d(...b){l||(l=!0,e.apply(null,b))}function h(b){s=setTimeout(()=>{s=null,t(f,c())},b)}function u(){r&&clearTimeout(r)}function f(b,...M){if(l){u();return}if(b){u(),d.call(null,b,...M);return}if(c()||o){u(),d.call(null,b,...M);return}i<64&&(i*=2);let w;a===1?(a=2,w=0):w=(i+Math.random())*1e3,h(w)}let _=!1;function v(b){_||(_=!0,u(),!l&&(s!==null?(b||(a=2),clearTimeout(s),h(0)):b||(a=1)))}return h(0),r=setTimeout(()=>{o=!0,v(!0)},n),v}function dm(t){t(!1)}function hm(t){return t!==void 0}function Sr(t,e,n,i){if(i<e)throw Tr(`Invalid value for '${t}'. Expected ${e} or greater.`);if(i>n)throw Tr(`Invalid value for '${t}'. Expected ${n} or less.`)}function fm(t){const e=encodeURIComponent;let n="?";for(const i in t)if(t.hasOwnProperty(i)){const s=e(i)+"="+e(t[i]);n=n+s+"&"}return n=n.slice(0,-1),n}var an;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(an||(an={}));function pm(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,r=e.indexOf(t)!==-1;return n||s||r}class mm{constructor(e,n,i,s,r,o,a,c,l,d,h,u=!0,f=!1){this.url_=e,this.method_=n,this.headers_=i,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=d,this.connectionFactory_=h,this.retry=u,this.isUsingEmulator=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((_,v)=>{this.resolve_=_,this.reject_=v,this.start_()})}start_(){const e=(i,s)=>{if(s){i(!1,new Mt(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const o=a=>{const c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;const a=r.getErrorCode()===an.NO_ERROR,c=r.getStatus();if(!a||pm(c,this.additionalRetryCodes_)&&this.retry){const d=r.getErrorCode()===an.ABORT;i(!1,new Mt(!1,null,d));return}const l=this.successCodes_.indexOf(c)!==-1;i(!0,new Mt(l,r))})},n=(i,s)=>{const r=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());hm(c)?r(c):r()}catch(c){o(c)}else if(a!==null){const c=im();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(s.canceled){const c=this.appDelete_?Ya():rm();o(c)}else{const c=sm();o(c)}};this.canceled_?n(!1,new Mt(!1,null,!0)):this.backoffId_=um(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&dm(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Mt{constructor(e,n,i){this.wasSuccessCode=e,this.connection=n,this.canceled=!!i}}function _m(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function gm(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function ym(t,e){e&&(t["X-Firebase-GMPID"]=e)}function vm(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function Em(t,e,n,i,s,r,o=!0,a=!1){const c=fm(t.urlParams),l=t.url+c,d=Object.assign({},t.headers);return ym(d,e),_m(d,n),gm(d,r),vm(d,i),new mm(l,t.method,d,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,a)}function bm(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function wm(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}class cn{constructor(e,n){this._service=e,n instanceof ne?this._location=n:this._location=ne.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new cn(e,n)}get root(){const e=new ne(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return wm(this._location.path)}get storage(){return this._service}get parent(){const e=bm(this._location.path);if(e===null)return null;const n=new ne(this._location.bucket,e);return new cn(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw cm(e)}}function kr(t,e){const n=e?.[em];return n==null?null:ne.makeFromBucketSpec(n,t)}function Cm(t,e,n,i={}){t.host=`${e}:${n}`;const s=fn(e);s&&(qr(`https://${t.host}/b`),Yr("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:r}=i;r&&(t._overrideAuthToken=typeof r=="string"?r:Kr(r,t.app.options.projectId))}class Im{constructor(e,n,i,s,r,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=i,this._url=s,this._firebaseVersion=r,this._isUsingEmulator=o,this._bucket=null,this._host=Ka,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=tm,this._maxUploadRetryTime=nm,this._requests=new Set,s!=null?this._bucket=ne.makeFromBucketSpec(s,this._host):this._bucket=kr(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=ne.makeFromBucketSpec(this._url,e):this._bucket=kr(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Sr("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Sr("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(io(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new cn(this,e)}_makeRequest(e,n,i,s,r=!0){if(this._deleted)return new lm(Ya());{const o=Em(e,this._appId,i,s,n,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[i,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,i,s).getPromise()}}const Rr="@firebase/storage",Ar="0.14.0";const Qa="storage";function Tm(t=Ti(),e){t=ae(t);const i=Ze(t,Qa).getImmediate({identifier:e}),s=zr("storage");return s&&Sm(i,...s),i}function Sm(t,e,n,i={}){Cm(t,e,n,i)}function km(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Im(n,i,s,e,so)}function Rm(){fe(new re(Qa,km,"PUBLIC").setMultipleInstances(!0)),X(Rr,Ar,""),X(Rr,Ar,"esm2020")}Rm();const Am={apiKey:"AIzaSyD9821q_YpfGHH9ZFPBXgVXQSyxbAfSGvk",authDomain:"aera-3f59e.firebaseapp.com",projectId:"aera-3f59e",storageBucket:"aera-3f59e.firebasestorage.app",messagingSenderId:"533520508445",appId:"1:533520508445:web:a0906e788e0d6e524888f4",measurementId:"G-J7K9HKBL6K",databaseURL:"https://aera-3f59e-default-rtdb.firebaseio.com"},hs=ro(Am);Fd(hs);const fs=Qp(hs);Tm(hs);window.addEventListener("DOMContentLoaded",function(){document.getElementById("Typing-Region").focus()});document.getElementById("send").addEventListener("click",Xa);document.getElementById("Typing-Region").addEventListener("keypress",t=>{t.key==="Enter"&&(t.preventDefault(),Xa())});function Xa(){const t=document.getElementById("Typing-Region").innerText.trim();t!==""&&Ja(t,"text").then(e=>null)}document.querySelector("form").addEventListener("submit",async t=>{t.preventDefault();const e=document.querySelector("input").value.trim();if(e){const n=Nm();sessionStorage.setItem("userId",n),sessionStorage.setItem("userName",e);const i=us(fs,`users/${n}`);await Ga(i,{username:e,userId:n,online:!0,lastActive:qa()}),alert(`Welcome ${e}! You are now logged in.`),document.getElementsByClassName("FirstView")[0].style.display="none",document.querySelector("main").style.display="block",xm()}});function Nm(){if(crypto?.randomUUID)return crypto.randomUUID();if(crypto?.getRandomValues){const t=new Uint32Array(4);return crypto.getRandomValues(t),t.join("-")}else return"user-"+Math.floor(Math.random()*1e6)}async function Ja(t,e){const n=Up(us(fs,"Messages")),i={userID:sessionStorage.getItem("userId"),userName:sessionStorage.getItem("userName"),type:e,msg:t,timeStamp:qa()};await Ga(n,i),console.log("Message sent successfully")}function xm(){const t=us(fs,"Messages");Wp(t,e=>{const n=e.val();Dm(n)})}function Dm(t){var e;t.userID===sessionStorage.getItem("userId")?e="You :":e=`${t.userName} :`;var n;if(t.type==="image")n=document.createElement("img"),n.src=t.msg,n.style.maxWidth="50vw",n.style.borderRadius="10px",n.style.margin="5px 0";else{var i=`${e} ${t.msg}`;n=document.createElement("div"),n.classList.add("NewMessage"),n.textContent=i,document.getElementById("Typing-Region").innerText=""}document.getElementById("Chat-Box").appendChild(n),document.getElementById("Typing-Region").focus()}document.getElementById("uploadBtn").addEventListener("click",()=>{window.myWidget.open()});window.addEventListener("cloudinary-upload",async t=>{const e=t.detail;await Ja(e,"image")});function Lt(t){if(typeof t!="string"||!t)throw new Error("expected a non-empty string, got: "+t)}function Hn(t){if(typeof t!="number")throw new Error("expected a number, got: "+t)}const Pm=1,Om=1,je="emoji",Xe="keyvalue",ps="favorites",Mm="tokens",Za="tokens",Lm="unicode",ec="count",Fm="group",jm="order",tc="group-order",_i="eTag",ln="url",Nr="skinTone",it="readonly",ms="readwrite",nc="skinUnicodes",Bm="skinUnicodes",Um="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",$m="en";function Wm(t,e){const n=new Set,i=[];for(const s of t){const r=e(s);n.has(r)||(n.add(r),i.push(s))}return i}function xr(t){return Wm(t,e=>e.unicode)}function Hm(t){function e(n,i,s){const r=i?t.createObjectStore(n,{keyPath:i}):t.createObjectStore(n);if(s)for(const[o,[a,c]]of Object.entries(s))r.createIndex(o,a,{multiEntry:c});return r}e(Xe),e(je,Lm,{[Za]:[Mm,!0],[tc]:[[Fm,jm]],[nc]:[Bm,!0]}),e(ps,void 0,{[ec]:[""]})}const gi={},Ut={},un={};function ic(t,e,n){n.onerror=()=>e(n.error),n.onblocked=()=>e(new Error("IDB blocked")),n.onsuccess=()=>t(n.result)}async function Vm(t){const e=await new Promise((n,i)=>{const s=indexedDB.open(t,Pm);gi[t]=s,s.onupgradeneeded=r=>{r.oldVersion<Om&&Hm(s.result)},ic(n,i,s)});return e.onclose=()=>_s(t),e}function zm(t){return Ut[t]||(Ut[t]=Vm(t)),Ut[t]}function ge(t,e,n,i){return new Promise((s,r)=>{const o=t.transaction(e,n,{durability:"relaxed"}),a=typeof e=="string"?o.objectStore(e):e.map(l=>o.objectStore(l));let c;i(a,o,l=>{c=l}),o.oncomplete=()=>s(c),o.onerror=()=>r(o.error)})}function _s(t){const e=gi[t],n=e&&e.result;if(n){n.close();const i=un[t];if(i)for(const s of i)s()}delete gi[t],delete Ut[t],delete un[t]}function Gm(t){return new Promise((e,n)=>{_s(t);const i=indexedDB.deleteDatabase(t);ic(e,n,i)})}function qm(t,e){let n=un[t];n||(n=un[t]=[]),n.push(e)}const Km=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function ze(t){return t.split(/[\s_]+/).map(e=>!e.match(/\w/)||Km.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(//g,"'").toLowerCase()).filter(Boolean)}const Ym=2;function sc(t){return t.filter(Boolean).map(e=>e.toLowerCase()).filter(e=>e.length>=Ym)}function Qm(t){return t.map(({annotation:n,emoticon:i,group:s,order:r,shortcodes:o,skins:a,tags:c,emoji:l,version:d})=>{const h=[...new Set(sc([...(o||[]).map(ze).flat(),...(c||[]).map(ze).flat(),...ze(n),i]))].sort(),u={annotation:n,group:s,order:r,tags:c,tokens:h,unicode:l,version:d};if(i&&(u.emoticon=i),o&&(u.shortcodes=o),a){u.skinTones=[],u.skinUnicodes=[],u.skinVersions=[];for(const{tone:f,emoji:_,version:v}of a)u.skinTones.push(f),u.skinUnicodes.push(_),u.skinVersions.push(v)}return u})}function rc(t,e,n,i){t[e](n).onsuccess=s=>i&&i(s.target.result)}function Le(t,e,n){rc(t,"get",e,n)}function oc(t,e,n){rc(t,"getAll",e,n)}function gs(t){t.commit&&t.commit()}function Xm(t,e){let n=t[0];for(let i=1;i<t.length;i++){const s=t[i];e(n)>e(s)&&(n=s)}return n}function ac(t,e){const n=Xm(t,s=>s.length),i=[];for(const s of n)t.some(r=>r.findIndex(o=>e(o)===e(s))===-1)||i.push(s);return i}async function Jm(t){return!await ys(t,Xe,ln)}async function Zm(t,e,n){const[i,s]=await Promise.all([_i,ln].map(r=>ys(t,Xe,r)));return i===n&&s===e}async function e_(t,e){return ge(t,je,it,(i,s,r)=>{let o;const a=()=>{i.getAll(o&&IDBKeyRange.lowerBound(o,!0),50).onsuccess=c=>{const l=c.target.result;for(const d of l)if(o=d.unicode,e(d))return r(d);if(l.length<50)return r();a()}};a()})}async function cc(t,e,n,i){try{const s=Qm(e);await ge(t,[je,Xe],ms,([r,o],a)=>{let c,l,d=0;function h(){++d===2&&u()}function u(){if(!(c===i&&l===n)){r.clear();for(const f of s)r.put(f);o.put(i,_i),o.put(n,ln),gs(a)}}Le(o,_i,f=>{c=f,h()}),Le(o,ln,f=>{l=f,h()})})}finally{}}async function t_(t,e){return ge(t,je,it,(n,i,s)=>{const r=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);oc(n.index(tc),r,s)})}async function lc(t,e){const n=sc(ze(e));return n.length?ge(t,je,it,(i,s,r)=>{const o=[],a=()=>{o.length===n.length&&c()},c=()=>{const l=ac(o,d=>d.unicode);r(l.sort((d,h)=>d.order<h.order?-1:1))};for(let l=0;l<n.length;l++){const d=n[l],h=l===n.length-1?IDBKeyRange.bound(d,d+"",!1,!0):IDBKeyRange.only(d);oc(i.index(Za),h,u=>{o.push(u),a()})}}):[]}async function n_(t,e){const n=await lc(t,e);return n.length?n.filter(i=>(i.shortcodes||[]).map(r=>r.toLowerCase()).includes(e.toLowerCase()))[0]||null:await e_(t,s=>(s.shortcodes||[]).includes(e.toLowerCase()))||null}async function i_(t,e){return ge(t,je,it,(n,i,s)=>Le(n,e,r=>{if(r)return s(r);Le(n.index(nc),e,o=>s(o||null))}))}function ys(t,e,n){return ge(t,e,it,(i,s,r)=>Le(i,n,r))}function s_(t,e,n,i){return ge(t,e,ms,(s,r)=>{s.put(i,n),gs(r)})}function r_(t,e){return ge(t,ps,ms,(n,i)=>Le(n,e,s=>{n.put((s||0)+1,e),gs(i)}))}function o_(t,e,n){return n===0?[]:ge(t,[ps,je],it,([i,s],r,o)=>{const a=[];i.index(ec).openCursor(void 0,"prev").onsuccess=c=>{const l=c.target.result;if(!l)return o(a);function d(f){if(a.push(f),a.length===n)return o(a);l.continue()}const h=l.primaryKey,u=e.byName(h);if(u)return d(u);Le(s,h,f=>{if(f)return d(f);l.continue()})}})}const Ft="";function a_(t,e){const n=new Map;for(const s of t){const r=e(s);for(const o of r){let a=n;for(let l=0;l<o.length;l++){const d=o.charAt(l);let h=a.get(d);h||(h=new Map,a.set(d,h)),a=h}let c=a.get(Ft);c||(c=[],a.set(Ft,c)),c.push(s)}}return(s,r)=>{let o=n;for(let l=0;l<s.length;l++){const d=s.charAt(l),h=o.get(d);if(h)o=h;else return[]}if(r)return o.get(Ft)||[];const a=[],c=[o];for(;c.length;){const d=[...c.shift().entries()].sort((h,u)=>h[0]<u[0]?-1:1);for(const[h,u]of d)h===Ft?a.push(...u):c.push(u)}return a}}const c_=["name","url"];function l_(t){const e=t&&Array.isArray(t),n=e&&t.length&&(!t[0]||c_.some(i=>!(i in t[0])));if(!e||n)throw new Error("Custom emojis are in the wrong format")}function Dr(t){l_(t);const e=(u,f)=>u.name.toLowerCase()<f.name.toLowerCase()?-1:1,n=t.sort(e),s=a_(t,u=>{const f=new Set;if(u.shortcodes)for(const _ of u.shortcodes)for(const v of ze(_))f.add(v);return f}),r=u=>s(u,!0),o=u=>s(u,!1),a=u=>{const f=ze(u),_=f.map((v,b)=>(b<f.length-1?r:o)(v));return ac(_,v=>v.name).sort(e)},c=new Map,l=new Map;for(const u of t){l.set(u.name.toLowerCase(),u);for(const f of u.shortcodes||[])c.set(f.toLowerCase(),u)}return{all:n,search:a,byShortcode:u=>c.get(u.toLowerCase()),byName:u=>l.get(u.toLowerCase())}}const u_=typeof wrappedJSObject<"u";function lt(t){if(!t)return t;if(u_&&(t=structuredClone(t)),delete t.tokens,t.skinTones){const e=t.skinTones.length;t.skins=Array(e);for(let n=0;n<e;n++)t.skins[n]={tone:t.skinTones[n],unicode:t.skinUnicodes[n],version:t.skinVersions[n]};delete t.skinTones,delete t.skinUnicodes,delete t.skinVersions}return t}function uc(t){t||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const d_=["annotation","emoji","group","order","version"];function h_(t){if(!t||!Array.isArray(t)||!t[0]||typeof t[0]!="object"||d_.some(e=>!(e in t[0])))throw new Error("Emoji data is in the wrong format")}function dc(t,e){if(Math.floor(t.status/100)!==2)throw new Error("Failed to fetch: "+e+":  "+t.status)}async function f_(t){const e=await fetch(t,{method:"HEAD"});dc(e,t);const n=e.headers.get("etag");return uc(n),n}async function yi(t){const e=await fetch(t);dc(e,t);const n=e.headers.get("etag");uc(n);const i=await e.json();return h_(i),[n,i]}function p_(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,s=-1;++s<i;)e+=String.fromCharCode(n[s]);return e}function m_(t){for(var e=t.length,n=new ArrayBuffer(e),i=new Uint8Array(n),s=-1;++s<e;)i[s]=t.charCodeAt(s);return n}async function hc(t){const e=JSON.stringify(t);let n=m_(e);const i=await crypto.subtle.digest("SHA-1",n),s=p_(i);return btoa(s)}async function __(t,e){let n,i=await f_(e);if(!i){const s=await yi(e);i=s[0],n=s[1],i||(i=await hc(n))}await Zm(t,e,i)||(n||(n=(await yi(e))[1]),await cc(t,n,e,i))}async function g_(t,e){let[n,i]=await yi(e);n||(n=await hc(i)),await cc(t,i,e,n)}async function y_(t,e){try{await __(t,e)}catch(n){if(n.name!=="InvalidStateError")throw n}}class v_{constructor({dataSource:e=Um,locale:n=$m,customEmoji:i=[]}={}){this.dataSource=e,this.locale=n,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=Dr(i),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await zm(this._dbName);qm(this._dbName,this._clear);const n=this.dataSource;await Jm(e)?await g_(e,n):this._lazyUpdate=y_(e,n)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Hn(e),await this.ready(),xr(await t_(this._db,e)).map(lt)}async getEmojiBySearchQuery(e){Lt(e),await this.ready();const n=this._custom.search(e),i=xr(await lc(this._db,e)).map(lt);return[...n,...i]}async getEmojiByShortcode(e){Lt(e),await this.ready();const n=this._custom.byShortcode(e);return n||lt(await n_(this._db,e))}async getEmojiByUnicodeOrName(e){Lt(e),await this.ready();const n=this._custom.byName(e);return n||lt(await i_(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await ys(this._db,Xe,Nr)||0}async setPreferredSkinTone(e){return Hn(e),await this.ready(),s_(this._db,Xe,Nr,e)}async incrementFavoriteEmojiCount(e){return Lt(e),await this.ready(),r_(this._db,e)}async getTopFavoriteEmoji(e){return Hn(e),await this.ready(),(await o_(this._db,this._custom,e)).map(lt)}set customEmoji(e){this._custom=Dr(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await _s(this._dbName)}async delete(){await this._shutdown(),await Gm(this._dbName)}}const vi=[[-1,"","custom"],[0,"","smileys-emotion"],[1,"","people-body"],[3,"","animals-nature"],[4,"","food-drink"],[5,"","travel-places"],[6,"","activities"],[7,"","objects"],[8,"","symbols"],[9,"","flags"]].map(([t,e,n])=>({id:t,emoji:e,name:n})),Vn=vi.slice(1),E_=2,Pr=6,fc=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function Or(t){return t.unicode.includes("")}const b_={"":17,"":16,"":15.1,"":14,"":13.1,"":12.1,"":11,"":5,"":4,"":3,"":2,"":1,"":.7,"":.6},w_=1e3,C_="",I_=8,T_=["","","","","","","","","","","","","",""],pc='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',S_=(t,e)=>t<e?-1:t>e?1:0,Mr=(t,e)=>{const n=document.createElement("canvas");n.width=n.height=1;const i=n.getContext("2d",{willReadFrequently:!0});return i.textBaseline="top",i.font=`100px ${pc}`,i.fillStyle=e,i.scale(.01,.01),i.fillText(t,0,0),i.getImageData(0,0,1,1).data},k_=(t,e)=>{const n=[...t].join(","),i=[...e].join(",");return n===i&&!n.startsWith("0,0,0,")};function R_(t){const e=Mr(t,"#000"),n=Mr(t,"#fff");return e&&n&&k_(e,n)}function A_(){const t=Object.entries(b_);try{for(const[e,n]of t)if(R_(e))return n}catch{}finally{}return t[0][1]}let zn;const Gn=()=>(zn||(zn=new Promise(t=>fc(()=>t(A_())))),zn),Ei=new Map,N_="",x_="\uD83C",D_="",P_=127995,O_=57339;function M_(t,e){if(e===0)return t;const n=t.indexOf(D_);return n!==-1?t.substring(0,n)+String.fromCodePoint(P_+e-1)+t.substring(n):(t.endsWith(N_)&&(t=t.substring(0,t.length-1)),t+x_+String.fromCodePoint(O_+e-1))}function se(t){t.preventDefault(),t.stopPropagation()}function qn(t,e,n){return e+=t?-1:1,e<0?e=n.length-1:e>=n.length&&(e=0),e}function mc(t,e){const n=new Set,i=[];for(const s of t){const r=e(s);n.has(r)||(n.add(r),i.push(s))}return i}function L_(t,e){const n=i=>{const s={};for(const r of i)typeof r.tone=="number"&&r.version<=e&&(s[r.tone]=r.unicode);return s};return t.map(({unicode:i,skins:s,shortcodes:r,url:o,name:a,category:c,annotation:l})=>({unicode:i,name:a,shortcodes:r,url:o,category:c,annotation:l,id:i||a,skins:s&&n(s)}))}const $t=requestAnimationFrame;let F_=typeof ResizeObserver=="function";function j_(t,e,n){let i;F_?(i=new ResizeObserver(n),i.observe(t)):$t(n),e.addEventListener("abort",()=>{i&&i.disconnect()})}function Lr(t){{const e=document.createRange();return e.selectNode(t.firstChild),e.getBoundingClientRect().width}}let Kn;function B_(t,e,n){let i=!0;for(const s of t){const r=n(s);if(!r)continue;const o=Lr(r);typeof Kn>"u"&&(Kn=Lr(e));const a=o/1.8<Kn;Ei.set(s.unicode,a),a||(i=!1)}return i}function U_(t){return mc(t,e=>e)}function $_(t){t&&(t.scrollTop=0)}function _t(t,e,n){let i=t.get(e);return i||(i=n(),t.set(e,i)),i}function Fr(t){return""+t}function W_(t){const e=document.createElement("template");return e.innerHTML=t,e}const H_=new WeakMap,V_=new WeakMap,z_=Symbol("un-keyed"),G_="replaceChildren"in Element.prototype;function q_(t,e){G_?t.replaceChildren(...e):(t.innerHTML="",t.append(...e))}function K_(t,e){let n=t.firstChild,i=0;for(;n;){if(e[i]!==n)return!0;n=n.nextSibling,i++}return i!==e.length}function Y_(t,e){const{targetNode:n}=e;let{targetParentNode:i}=e,s=!1;i?s=K_(i,t):(s=!0,e.targetNode=void 0,e.targetParentNode=i=n.parentNode),s&&q_(i,t)}function Q_(t,e){for(const n of e){const{targetNode:i,currentExpression:s,binding:{expressionIndex:r,attributeName:o,attributeValuePre:a,attributeValuePost:c}}=n,l=t[r];if(s!==l)if(n.currentExpression=l,o)if(l===null)i.removeAttribute(o);else{const d=a+Fr(l)+c;i.setAttribute(o,d)}else{let d;Array.isArray(l)?Y_(l,n):l instanceof Element?(d=l,i.replaceWith(d)):i.nodeValue=Fr(l),d&&(n.targetNode=d)}}}function X_(t){let e="",n=!1,i=!1,s=-1;const r=new Map,o=[];let a=0;for(let l=0,d=t.length;l<d;l++){const h=t[l];if(e+=h.slice(a),l===d-1)break;for(let y=0;y<h.length;y++)switch(h.charAt(y)){case"<":{h.charAt(y+1)==="/"?o.pop():(n=!0,o.push(++s));break}case">":{n=!1,i=!1;break}case"=":{i=!0;break}}const u=o[o.length-1],f=_t(r,u,()=>[]);let _,v,b;if(i){const y=/(\S+)="?([^"=]*)$/.exec(h);_=y[1],v=y[2];const w=/^([^">]*)("?)/.exec(t[l+1]);b=w[1],e=e.slice(0,-1*y[0].length),a=w[0].length}else a=0;const M={attributeName:_,attributeValuePre:v,attributeValuePost:b,expressionIndex:l};f.push(M),!n&&!i&&(e+=" ")}return{template:W_(e),elementsToBindings:r}}function jr(t,e,n){for(let i=0;i<t.length;i++){const s=t[i],r=s.attributeName?e:e.firstChild,o={binding:s,targetNode:r,targetParentNode:void 0,currentExpression:void 0};n.push(o)}}function J_(t,e){const n=[];let i;if(e.size===1&&(i=e.get(0)))jr(i,t,n);else{const s=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT);let r=t,o=-1;do{const a=e.get(++o);a&&jr(a,r,n)}while(r=s.nextNode())}return n}function Z_(t){const{template:e,elementsToBindings:n}=_t(H_,t,()=>X_(t)),i=e.cloneNode(!0).content.firstElementChild,s=J_(i,n);return function(o){return Q_(o,s),i}}function eg(t){const e=_t(V_,t,()=>new Map);let n=z_;function i(r,...o){const a=_t(e,r,()=>new Map);return _t(a,n,()=>Z_(r))(o)}function s(r,o,a){return r.map((c,l)=>{const d=n;n=a(c);try{return o(c,l)}finally{n=d}})}return{map:s,html:i}}function tg(t,e,n,i,s,r,o,a,c){const{labelWithSkin:l,titleForEmoji:d,unicodeWithSkin:h}=n,{html:u,map:f}=eg(e);function _(y,w,R){return f(y,(U,le)=>u`<button role="${w?"option":"menuitem"}" aria-selected="${w?le===e.activeSearchItem:null}" aria-label="${l(U,e.currentSkinTone)}" title="${d(U)}" class="${"emoji"+(w&&le===e.activeSearchItem?" active":"")+(U.unicode?"":" custom-emoji")}" id="${`${R}-${U.id}`}" style="${U.unicode?null:`--custom-emoji-background: url(${JSON.stringify(U.url)})`}">${U.unicode?h(U,e.currentSkinTone):""}</button>`,U=>`${R}-${U.id}`)}const b=u`<section data-ref="rootElement" class="picker" aria-label="${e.i18n.regionLabel}" style="${e.pickerStyle||""}"><div class="pad-top"></div><div class="search-row"><div class="search-wrapper"><input id="search" class="search" type="search" role="combobox" enterkeyhint="search" placeholder="${e.i18n.searchLabel}" autocapitalize="none" autocomplete="off" spellcheck="true" aria-expanded="${!!(e.searchMode&&e.currentEmojis.length)}" aria-controls="search-results" aria-describedby="search-description" aria-autocomplete="list" aria-activedescendant="${e.activeSearchItemId?`emo-${e.activeSearchItemId}`:null}" data-ref="searchElement" data-on-input="onSearchInput" data-on-keydown="onSearchKeydown"><label class="sr-only" for="search">${e.i18n.searchLabel}</label> <span id="search-description" class="sr-only">${e.i18n.searchDescription}</span></div><div class="skintone-button-wrapper ${e.skinTonePickerExpandedAfterAnimation?"expanded":""}"><button id="skintone-button" class="emoji ${e.skinTonePickerExpanded?"hide-focus":""}" aria-label="${e.skinToneButtonLabel}" title="${e.skinToneButtonLabel}" aria-describedby="skintone-description" aria-haspopup="listbox" aria-expanded="${e.skinTonePickerExpanded}" aria-controls="skintone-list" data-on-click="onClickSkinToneButton">${e.skinToneButtonText||""}</button></div><span id="skintone-description" class="sr-only">${e.i18n.skinToneDescription}</span><div data-ref="skinToneDropdown" id="skintone-list" class="skintone-list hide-focus ${e.skinTonePickerExpanded?"":"hidden no-animate"}" style="transform:translateY(${e.skinTonePickerExpanded?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))"})" role="listbox" aria-label="${e.i18n.skinTonesLabel}" aria-activedescendant="skintone-${e.activeSkinTone}" aria-hidden="${!e.skinTonePickerExpanded}" tabIndex="-1" data-on-focusout="onSkinToneOptionsFocusOut" data-on-click="onSkinToneOptionsClick" data-on-keydown="onSkinToneOptionsKeydown" data-on-keyup="onSkinToneOptionsKeyup">${f(e.skinTones,(y,w)=>u`<div id="skintone-${w}" class="emoji ${w===e.activeSkinTone?"active":""}" aria-selected="${w===e.activeSkinTone}" role="option" title="${e.i18n.skinTones[w]}" aria-label="${e.i18n.skinTones[w]}">${y}</div>`,y=>y)}</div></div><div class="nav" role="tablist" style="grid-template-columns:repeat(${e.groups.length},1fr)" aria-label="${e.i18n.categoriesLabel}" data-on-keydown="onNavKeydown" data-on-click="onNavClick">${f(e.groups,y=>u`<button role="tab" class="nav-button" aria-controls="tab-${y.id}" aria-label="${e.i18n.categories[y.name]}" aria-selected="${!e.searchMode&&e.currentGroup.id===y.id}" title="${e.i18n.categories[y.name]}" data-group-id="${y.id}"><div class="nav-emoji emoji">${y.emoji}</div></button>`,y=>y.id)}</div><div class="indicator-wrapper"><div class="indicator" style="transform:translateX(${(e.isRtl?-1:1)*e.currentGroupIndex*100}%)"></div></div><div class="message ${e.message?"":"gone"}" role="alert" aria-live="polite">${e.message||""}</div><div data-ref="tabpanelElement" class="tabpanel ${!e.databaseLoaded||e.message?"gone":""}" role="${e.searchMode?"region":"tabpanel"}" aria-label="${e.searchMode?e.i18n.searchResultsLabel:e.i18n.categories[e.currentGroup.name]}" id="${e.searchMode?null:`tab-${e.currentGroup.id}`}" tabIndex="0" data-on-click="onEmojiClick"><div data-action="calculateEmojiGridStyle">${f(e.currentEmojisWithCategories,(y,w)=>u`<div><div id="menu-label-${w}" class="category ${e.currentEmojisWithCategories.length===1&&e.currentEmojisWithCategories[0].category===""?"gone":""}" aria-hidden="true">${e.searchMode?e.i18n.searchResultsLabel:y.category?y.category:e.currentEmojisWithCategories.length>1?e.i18n.categories.custom:e.i18n.categories[e.currentGroup.name]}</div><div class="emoji-menu ${w!==0&&!e.searchMode&&e.currentGroup.id===-1?"visibility-auto":""}" style="${`--num-rows: ${Math.ceil(y.emojis.length/e.numColumns)}`}" data-action="updateOnIntersection" role="${e.searchMode?"listbox":"menu"}" aria-labelledby="menu-label-${w}" id="${e.searchMode?"search-results":null}">${_(y.emojis,e.searchMode,"emo")}</div></div>`,y=>y.category)}</div></div><div class="favorites onscreen emoji-menu ${e.message?"gone":""}" role="menu" aria-label="${e.i18n.favoritesLabel}" data-on-click="onEmojiClick">${_(e.currentFavorites,!1,"fav")}</div><button data-ref="baselineEmoji" aria-hidden="true" tabindex="-1" class="abs-pos hidden emoji baseline-emoji"></button></section>`,M=(y,w)=>{for(const R of t.querySelectorAll(`[${y}]`))w(R,R.getAttribute(y))};if(c){t.appendChild(b);for(const y of["click","focusout","input","keydown","keyup"])M(`data-on-${y}`,(w,R)=>{w.addEventListener(y,i[R])});M("data-ref",(y,w)=>{r[w]=y}),o.addEventListener("abort",()=>{t.removeChild(b)})}M("data-action",(y,w)=>{let R=a.get(w);R||a.set(w,R=new WeakSet),R.has(y)||(R.add(y),s[w](y))})}const dn=typeof queueMicrotask=="function"?queueMicrotask:t=>Promise.resolve().then(t);function ng(t){let e=!1,n;const i=new Map,s=new Set;let r;const o=()=>{if(e)return;const l=[...s];s.clear();try{for(const d of l)d()}finally{r=!1,s.size&&(r=!0,dn(o))}},a=new Proxy({},{get(l,d){if(n){let h=i.get(d);h||(h=new Set,i.set(d,h)),h.add(n)}return l[d]},set(l,d,h){if(l[d]!==h){l[d]=h;const u=i.get(d);if(u){for(const f of u)s.add(f);r||(r=!0,dn(o))}}return!0}}),c=l=>{const d=()=>{const h=n;n=d;try{return l()}finally{n=h}};return d()};return t.addEventListener("abort",()=>{e=!0}),{state:a,createEffect:c}}function Yn(t,e,n){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(!n(t[i],e[i]))return!1;return!0}const Br=new WeakMap;function ig(t,e,n){{const i=t.closest(".tabpanel");let s=Br.get(i);s||(s=new IntersectionObserver(n,{root:i,rootMargin:"50% 0px 50% 0px",threshold:0}),Br.set(i,s),e.addEventListener("abort",()=>{s.disconnect()})),s.observe(t)}}const Qn=[],{assign:jt}=Object;function sg(t,e){const n={},i=new AbortController,s=i.signal,{state:r,createEffect:o}=ng(s),a=new Map;jt(r,{skinToneEmoji:void 0,i18n:void 0,database:void 0,customEmoji:void 0,customCategorySorting:void 0,emojiVersion:void 0}),jt(r,e),jt(r,{initialLoad:!0,currentEmojis:[],currentEmojisWithCategories:[],rawSearchText:"",searchText:"",searchMode:!1,activeSearchItem:-1,message:void 0,skinTonePickerExpanded:!1,skinTonePickerExpandedAfterAnimation:!1,currentSkinTone:0,activeSkinTone:0,skinToneButtonText:void 0,pickerStyle:void 0,skinToneButtonLabel:"",skinTones:[],currentFavorites:[],defaultFavoriteEmojis:void 0,numColumns:I_,isRtl:!1,currentGroupIndex:0,groups:Vn,databaseLoaded:!1,activeSearchItemId:void 0}),o(()=>{r.currentGroup!==r.groups[r.currentGroupIndex]&&(r.currentGroup=r.groups[r.currentGroupIndex])});const c=p=>{t.getElementById(p).focus()},l=p=>t.getElementById(`emo-${p.id}`),d=(p,g)=>{n.rootElement.dispatchEvent(new CustomEvent(p,{detail:g,bubbles:!0,composed:!0}))},h=(p,g)=>p.id===g.id,u=(p,g)=>{const{category:C,emojis:k}=p,{category:$,emojis:H}=g;return C!==$?!1:Yn(k,H,h)},f=p=>{Yn(r.currentEmojis,p,h)||(r.currentEmojis=p)},_=p=>{r.searchMode!==p&&(r.searchMode=p)},v=p=>{Yn(r.currentEmojisWithCategories,p,u)||(r.currentEmojisWithCategories=p)},b=(p,g)=>g&&p.skins&&p.skins[g]||p.unicode,w={labelWithSkin:(p,g)=>U_([p.name||b(p,g),p.annotation,...p.shortcodes||Qn].filter(Boolean)).join(", "),titleForEmoji:p=>p.annotation||(p.shortcodes||Qn).join(", "),unicodeWithSkin:b},R={onClickSkinToneButton:Nc,onEmojiClick:Rc,onNavClick:Tc,onNavKeydown:Sc,onSearchKeydown:Ic,onSkinToneOptionsClick:Ac,onSkinToneOptionsFocusOut:Pc,onSkinToneOptionsKeydown:xc,onSkinToneOptionsKeyup:Dc,onSearchInput:Oc},U={calculateEmojiGridStyle:st,updateOnIntersection:vc};let le=!0;o(()=>{tg(t,r,w,R,U,n,s,a,le),le=!1}),r.emojiVersion||Gn().then(p=>{p||(r.message=r.i18n.emojiUnsupportedMessage)}),o(()=>{async function p(){let g=!1;const C=setTimeout(()=>{g=!0,r.message=r.i18n.loadingMessage},w_);try{await r.database.ready(),r.databaseLoaded=!0}catch(k){console.error(k),r.message=r.i18n.networkErrorMessage}finally{clearTimeout(C),g&&(g=!1,r.message="")}}r.database&&p()}),o(()=>{r.pickerStyle=`
      --num-groups: ${r.groups.length}; 
      --indicator-opacity: ${r.searchMode?0:1}; 
      --num-skintones: ${Pr};`}),o(()=>{r.customEmoji&&r.database&&xt()}),o(()=>{r.customEmoji&&r.customEmoji.length?r.groups!==vi&&(r.groups=vi):r.groups!==Vn&&(r.currentGroupIndex&&r.currentGroupIndex--,r.groups=Vn)}),o(()=>{async function p(){r.databaseLoaded&&(r.currentSkinTone=await r.database.getPreferredSkinTone())}p()}),o(()=>{r.skinTones=Array(Pr).fill().map((p,g)=>M_(r.skinToneEmoji,g))}),o(()=>{r.skinToneButtonText=r.skinTones[r.currentSkinTone]}),o(()=>{r.skinToneButtonLabel=r.i18n.skinToneLabel.replace("{skinTone}",r.i18n.skinTones[r.currentSkinTone])}),o(()=>{async function p(){const{database:g}=r,C=(await Promise.all(T_.map(k=>g.getEmojiByUnicodeOrName(k)))).filter(Boolean);r.defaultFavoriteEmojis=C}r.databaseLoaded&&p()});function xt(){const{customEmoji:p,database:g}=r,C=p||Qn;g.customEmoji!==C&&(g.customEmoji=C)}o(()=>{async function p(){xt();const{database:g,defaultFavoriteEmojis:C,numColumns:k}=r,$=await g.getTopFavoriteEmoji(k),H=await Sn(mc([...$,...C],J=>J.unicode||J.name).slice(0,k));r.currentFavorites=H}r.databaseLoaded&&r.defaultFavoriteEmojis&&p()});function st(p){j_(p,s,()=>{{const g=getComputedStyle(n.rootElement),C=parseInt(g.getPropertyValue("--num-columns"),10),k=g.getPropertyValue("direction")==="rtl";r.numColumns=C,r.isRtl=k}})}function vc(p){ig(p,s,g=>{for(const{target:C,isIntersecting:k}of g)C.classList.toggle("onscreen",k)})}o(()=>{async function p(){const{searchText:g,currentGroup:C,databaseLoaded:k,customEmoji:$}=r;if(!k)r.currentEmojis=[],r.searchMode=!1;else if(g.length>=E_){const H=await Cc(g);r.searchText===g&&(f(H),_(!0))}else{const{id:H}=C;if(H!==-1||$&&$.length){const J=await wc(H);r.currentGroup.id===H&&(f(J),_(!1))}}}p()});const vs=()=>{$t(()=>$_(n.tabpanelElement))};o(()=>{const{currentEmojis:p,emojiVersion:g}=r,C=p.filter(k=>k.unicode).filter(k=>Or(k)&&!Ei.has(k.unicode));if(!g&&C.length)f(p),$t(()=>Ec(C));else{const k=g?p:p.filter(bc);f(k),vs()}});function Ec(p){B_(p,n.baselineEmoji,l)?vs():r.currentEmojis=[...r.currentEmojis]}function bc(p){return!p.unicode||!Or(p)||Ei.get(p.unicode)}async function Es(p){const g=r.emojiVersion||await Gn();return p.filter(({version:C})=>!C||C<=g)}async function Sn(p){return L_(p,r.emojiVersion||await Gn())}async function wc(p){const g=p===-1?r.customEmoji:await r.database.getEmojiByGroup(p);return Sn(await Es(g))}async function Cc(p){return Sn(await Es(await r.database.getEmojiBySearchQuery(p)))}o(()=>{}),o(()=>{function p(){const{searchMode:C,currentEmojis:k}=r;if(C)return[{category:"",emojis:k}];const $=new Map;for(const H of k){const J=H.category||"";let Dt=$.get(J);Dt||(Dt=[],$.set(J,Dt)),Dt.push(H)}return[...$.entries()].map(([H,J])=>({category:H,emojis:J})).sort((H,J)=>r.customCategorySorting(H.category,J.category))}const g=p();v(g)}),o(()=>{r.activeSearchItemId=r.activeSearchItem!==-1&&r.currentEmojis[r.activeSearchItem].id}),o(()=>{const{rawSearchText:p}=r;fc(()=>{r.searchText=(p||"").trim(),r.activeSearchItem=-1})});function Ic(p){if(!r.searchMode||!r.currentEmojis.length)return;const g=C=>{se(p),r.activeSearchItem=qn(C,r.activeSearchItem,r.currentEmojis)};switch(p.key){case"ArrowDown":return g(!1);case"ArrowUp":return g(!0);case"Enter":if(r.activeSearchItem===-1)r.activeSearchItem=0;else return se(p),bs(r.currentEmojis[r.activeSearchItem].id)}}function Tc(p){const{target:g}=p,C=g.closest(".nav-button");if(!C)return;const k=parseInt(C.dataset.groupId,10);n.searchElement.value="",r.rawSearchText="",r.searchText="",r.activeSearchItem=-1,r.currentGroupIndex=r.groups.findIndex($=>$.id===k)}function Sc(p){const{target:g,key:C}=p,k=$=>{$&&(se(p),$.focus())};switch(C){case"ArrowLeft":return k(g.previousElementSibling);case"ArrowRight":return k(g.nextElementSibling);case"Home":return k(g.parentElement.firstElementChild);case"End":return k(g.parentElement.lastElementChild)}}async function kc(p){const g=await r.database.getEmojiByUnicodeOrName(p),C=[...r.currentEmojis,...r.currentFavorites].find($=>$.id===p),k=C.unicode&&b(C,r.currentSkinTone);return await r.database.incrementFavoriteEmojiCount(p),{emoji:g,skinTone:r.currentSkinTone,...k&&{unicode:k},...C.name&&{name:C.name}}}async function bs(p){const g=kc(p);d("emoji-click-sync",g),d("emoji-click",await g)}function Rc(p){const{target:g}=p;if(!g.classList.contains("emoji"))return;se(p);const C=g.id.substring(4);bs(C)}function kn(p){r.currentSkinTone=p,r.skinTonePickerExpanded=!1,c("skintone-button"),d("skin-tone-change",{skinTone:p}),r.database.setPreferredSkinTone(p)}function Ac(p){const{target:{id:g}}=p,C=g&&g.match(/^skintone-(\d)/);if(!C)return;se(p);const k=parseInt(C[1],10);kn(k)}function Nc(p){r.skinTonePickerExpanded=!r.skinTonePickerExpanded,r.activeSkinTone=r.currentSkinTone,r.skinTonePickerExpanded&&(se(p),$t(()=>c("skintone-list")))}o(()=>{r.skinTonePickerExpanded?n.skinToneDropdown.addEventListener("transitionend",()=>{r.skinTonePickerExpandedAfterAnimation=!0},{once:!0}):r.skinTonePickerExpandedAfterAnimation=!1});function xc(p){if(!r.skinTonePickerExpanded)return;const g=async C=>{se(p),r.activeSkinTone=C};switch(p.key){case"ArrowUp":return g(qn(!0,r.activeSkinTone,r.skinTones));case"ArrowDown":return g(qn(!1,r.activeSkinTone,r.skinTones));case"Home":return g(0);case"End":return g(r.skinTones.length-1);case"Enter":return se(p),kn(r.activeSkinTone);case"Escape":return se(p),r.skinTonePickerExpanded=!1,c("skintone-button")}}function Dc(p){if(r.skinTonePickerExpanded)switch(p.key){case" ":return se(p),kn(r.activeSkinTone)}}async function Pc(p){const{relatedTarget:g}=p;(!g||g.id!=="skintone-list")&&(r.skinTonePickerExpanded=!1)}function Oc(p){r.rawSearchText=p.target.value}return{$set(p){jt(r,p)},$destroy(){i.abort()}}}const rg="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",og="en";var ag={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}},cg=':host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--border-radius:0;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;scrollbar-gutter:stable;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.emoji-menu.visibility-auto{content-visibility:auto;contain-intrinsic-size:calc(var(--num-columns)*var(--total-emoji-size)) calc(var(--num-rows)*var(--total-emoji-size))}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;height:var(--total-emoji-size);width:var(--total-emoji-size);line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.onscreen .custom-emoji::after{content:"";width:var(--emoji-size);height:var(--emoji-size);background-repeat:no-repeat;background-position:center center;background-size:contain;background-image:var(--custom-emoji-background)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{overflow-y:auto;scrollbar-gutter:stable;display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}';const _c=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],lg=`:host{--emoji-font-family:${pc}}`;class gc extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const n=document.createElement("style");n.textContent=cg+lg,this.shadowRoot.appendChild(n),this._ctx={locale:og,dataSource:rg,skinToneEmoji:C_,customCategorySorting:S_,customEmoji:null,i18n:ag,emojiVersion:null,...e};for(const i of _c)i!=="database"&&Object.prototype.hasOwnProperty.call(this,i)&&(this._ctx[i]=this[i],delete this[i]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=sg(this.shadowRoot,this._ctx))}disconnectedCallback(){dn(()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e.close().catch(n=>console.error(n))}})}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(e,n,i){this._set(e.replace(/-([a-z])/g,(s,r)=>r.toUpperCase()),e==="emoji-version"?parseFloat(i):i)}_set(e,n){this._ctx[e]=n,this._cmp&&this._cmp.$set({[e]:n}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:n,database:i}=this._ctx;(!i||i.locale!==e||i.dataSource!==n)&&this._set("database",new v_({locale:e,dataSource:n}))}_dbFlush(){dn(()=>this._dbCreate())}}const yc={};for(const t of _c)yc[t]={get(){return t==="database"&&this._dbCreate(),this._ctx[t]},set(e){if(t==="database")throw new Error("database is read-only");this._set(t,e)}};Object.defineProperties(gc.prototype,yc);customElements.get("emoji-picker")||customElements.define("emoji-picker",gc);document.querySelector("emoji-picker").addEventListener("emoji-click",t=>{const e=t.detail.unicode;ug(e)});function ug(t){const e=window.getSelection();if(!e||!e.rangeCount)return;const n=e.getRangeAt(0);n.deleteContents();const i=document.createTextNode(t);n.insertNode(i),n.setStart(i),n.setEndAfter(i),e.removeAllRanges(),e.addRange(n)}
